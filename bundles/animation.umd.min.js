!function(global,factory){if("function"==typeof define&&define.amd)define("@angular/animation",["exports","@angular/core"],factory);else if("undefined"!=typeof exports)factory(exports,require("@angular/core"));else{var mod={exports:{}};factory(mod.exports,global.ng.core),global.ng=global.ng||{},global.ng.animation=mod.exports}}(this,function(exports,_core){"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function makeBooleanMap(e){var t={};return e.forEach(function(r){return t[r]=!0}),t}function dashCaseToCamelCase(e){return e.replace(DASH_CASE_REGEXP,function(){for(var _len=arguments.length,t=Array(_len),_key=0;_key<_len;_key++)t[_key]=arguments[_key];return t[1].toUpperCase()})}function getOrSetAsInMap(e,t,r){var n=e.get(t);return n||e.set(t,n=r),n}function deleteFromArrayMap(e,t,r){var n=e.get(t);if(n){var a=n.indexOf(r);0<=a&&(n.splice(a,1),0==n.length&&e.delete(t))}}function setStyles(e,t){Object.keys(t).forEach(function(r){e.style[r]=t[r]})}function eraseStyles(e,t){Object.keys(t).forEach(function(r){e.style[r]=""})}function optimizeGroupPlayer(e){return 1==e.length?e[0]:new _core.ɵAnimationGroupPlayer(e)}function copyArray(e){return e?e.splice(0):[]}function remove(e){e.parentNode.removeChild(e)}function _computeStyle(e,t){return window.getComputedStyle(e)[t]}function _copyKeyframeStyles(e){var t={};return Object.keys(e).forEach(function(r){"offset"!=r&&(t[r]=e[r])}),t}function supportsWebAnimations(){return"undefined"!=typeof Element&&"function"==typeof Element.prototype.animate}function resolveDefaultAnimationDriver(){return supportsWebAnimations()?new WebAnimationsDriver:new NoOpAnimationDriver}function parseTimeExpression(e,t){var r=/^([\.\d]+)(m?s)(?:\s+([\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,n=void 0,a=0,o=null;if("string"==typeof e){var _l=e.match(r);if(null===_l)return t.push('The provided timing value "'+e+'" is invalid.'),{duration:0,delay:0,easing:null};var u=parseFloat(_l[1]),d=_l[2];"s"==d&&(u*=ONE_SECOND),n=Math.floor(u);var y=_l[3],f=_l[4];if(null!=y){var _=parseFloat(y);null!=f&&"s"==f&&(_*=ONE_SECOND),a=Math.floor(_)}var c=_l[5];c&&(o=c)}else n=e;return{duration:n,delay:a,easing:o}}function normalizeStyles(e){var t={};return e.styles.forEach(function(r){return copyStyles(r,!1,t)}),t}function copyStyles(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t)for(var n in e)r[n]=e[n];else Object.keys(e).forEach(function(n){return r[n]=e[n]});return r}function animate(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{type:4,styles:t,timings:e}}function group(e){return{type:3,steps:e}}function sequence(e){return{type:2,steps:e}}function style(e){var t=void 0,r=null;return t=Array.isArray(e)?e:[e],t.forEach(function(n){var a=n.offset;null!=a&&(r=null==r?parseFloat(a):r)}),_style(r,t)}function _style(e,t){return{type:6,styles:t,offset:e}}function state(e,t){return{type:0,name:e,styles:t}}function keyframes(e){return{type:5,steps:e}}function transition(e,t){return{type:1,expr:e,animation:Array.isArray(t)?sequence(t):t}}function visitAnimationNode(e,t,r){switch(t.type){case 0:return e.visitState(t,r);case 1:return e.visitTransition(t,r);case 2:return e.visitSequence(t,r);case 3:return e.visitGroup(t,r);case 4:return e.visitAnimate(t,r);case 5:return e.visitKeyframeSequence(t,r);case 6:return e.visitStyle(t,r);default:throw new Error("Unable to resolve animation metadata node #"+t.type)}}function createTimelineInstruction(e,t,r,n){return{type:1,keyframes:e,duration:t,delay:r,easing:n}}function buildAnimationKeyframes(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Array.isArray(e)?sequence(e):e;return(new AnimationTimelineVisitor).buildKeyframes(n,t,r)}function validateAnimationSequence(e){return(new AnimationValidatorVisitor).validate(e)}function parseTransitionExpr(e,t){var r=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(function(n){return parseInnerTransitionStr(n,r,t)}):r.push(e),r}function parseInnerTransitionStr(e,t,r){":"==e[0]&&(e=parseAnimationAlias(e,r));var n=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==n||4>n.length)return r.push('The provided transition expression "'+e+'" is not supported'),t;var a=n[1],o=n[2],l=n[3];t.push(makeLambdaFromStates(a,l)),"<"!=o[0]||a==ANY_STATE&&l==ANY_STATE||t.push(makeLambdaFromStates(l,a))}function parseAnimationAlias(e,t){return":enter"===e?"void => *":":leave"===e?"* => void":(t.push('The transition alias value "'+e+'" is not supported'),"* => *")}function makeLambdaFromStates(e,t){return function(r,n){return!(e!=ANY_STATE&&e!=r||t!=ANY_STATE&&t!=n)}}function createTransitionInstruction(e,t,r,n,a){return{type:0,triggerName:e,isRemovalTransition:t,fromStyles:r,toStyles:n,timelines:a}}function oneOrMoreTransitionsMatch(e,t,r){return e.some(function(n){return n(t,r)})}function trigger(e,t){return(new AnimationTriggerVisitor).buildTrigger(e,t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ɵf=exports.ɵc=exports.ɵe=exports.ɵd=exports.ɵa=exports.trigger=exports.AnimationTrigger=exports.transition=exports.style=exports.state=exports.sequence=exports.keyframes=exports.group=exports.animate=exports.AUTO_STYLE=exports.Animation=exports.AnimationModule=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),AnimationStyleNormalizer=function(){function AnimationStyleNormalizer(){_classCallCheck(this,AnimationStyleNormalizer)}return _createClass(AnimationStyleNormalizer,[{key:"normalizePropertyName",value:function(){}},{key:"normalizeStyleValue",value:function(){}}]),AnimationStyleNormalizer}(),WebAnimationsStyleNormalizer=function(_AnimationStyleNormal){function WebAnimationsStyleNormalizer(){return _classCallCheck(this,WebAnimationsStyleNormalizer),_possibleConstructorReturn(this,(WebAnimationsStyleNormalizer.__proto__||Object.getPrototypeOf(WebAnimationsStyleNormalizer)).apply(this,arguments))}return _inherits(WebAnimationsStyleNormalizer,_AnimationStyleNormal),_createClass(WebAnimationsStyleNormalizer,[{key:"normalizePropertyName",value:function(e){return dashCaseToCamelCase(e)}},{key:"normalizeStyleValue",value:function(e,t,r,n){var a="",o=r.toString().trim();if(DIMENSIONAL_PROP_MAP[t]&&0!==r&&"0"!==r)if("number"==typeof r)a="px";else{var l=r.match(/^[+-]?[\d\.]+([a-z]*)$/);l&&0==l[1].length&&n.push("Please provide a CSS unit value for "+e+":"+r)}return o+a}}]),WebAnimationsStyleNormalizer}(AnimationStyleNormalizer),DIMENSIONAL_PROP_MAP=makeBooleanMap("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent".split(",")),DASH_CASE_REGEXP=/-+([a-z0-9])/g,NoOpAnimationDriver=function(){function NoOpAnimationDriver(){_classCallCheck(this,NoOpAnimationDriver)}return _createClass(NoOpAnimationDriver,[{key:"animate",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return new _core.ɵNoOpAnimationPlayer}}]),NoOpAnimationDriver}(),AnimationDriver=function(){function AnimationDriver(){_classCallCheck(this,AnimationDriver)}return _createClass(AnimationDriver,[{key:"animate",value:function(){}}]),AnimationDriver}();AnimationDriver.NOOP=new NoOpAnimationDriver;var DomAnimationTransitionEngine=function(_TransitionEngine){function DomAnimationTransitionEngine(e,t){var _this2;return _classCallCheck(this,DomAnimationTransitionEngine),_this2=_possibleConstructorReturn(this,(DomAnimationTransitionEngine.__proto__||Object.getPrototypeOf(DomAnimationTransitionEngine)).call(this)),_this2._driver=e,_this2._normalizer=t,_this2._flaggedInserts=new Set,_this2._queuedRemovals=[],_this2._queuedAnimations=[],_this2._activeElementAnimations=new Map,_this2._activeTransitionAnimations=new Map,_this2}return _inherits(DomAnimationTransitionEngine,_TransitionEngine),_createClass(DomAnimationTransitionEngine,[{key:"insertNode",value:function(e,t){e.appendChild(t),this._flaggedInserts.add(t)}},{key:"removeNode",value:function(e){this._queuedRemovals.push(e)}},{key:"process",value:function(e,t){var _this3=this,r=t.map(function(n){return 0==n.type?_this3._handleTransitionAnimation(e,n):1==n.type?_this3._handleTimelineAnimation(e,n,[]):new _core.ɵNoOpAnimationPlayer});return optimizeGroupPlayer(r)}},{key:"_handleTransitionAnimation",value:function(e,t){var _this4=this,r=t.triggerName,n=getOrSetAsInMap(this._activeTransitionAnimations,e,{}),a=void 0;if(t.isRemovalTransition)a=copyArray(this._activeElementAnimations.get(e));else{a=[];var u=n[r];u&&a.push(u)}eraseStyles(e,t.fromStyles);var o=t.timelines.map(function(u){return _this4._buildPlayer(e,u,a)});a.forEach(function(u){return u.destroy()});var l=optimizeGroupPlayer(o);return l.onDone(function(){l.destroy();var u=_this4._activeTransitionAnimations.get(e);u&&(delete u[r],0==Object.keys(u).length&&_this4._activeTransitionAnimations.delete(e)),deleteFromArrayMap(_this4._activeElementAnimations,e,l),setStyles(e,t.toStyles)}),this._queuePlayer(e,l),n[r]=l,l}},{key:"_handleTimelineAnimation",value:function(e,t,r){var _this5=this,n=this._buildPlayer(e,t,r);return n.onDestroy(function(){deleteFromArrayMap(_this5._activeElementAnimations,e,n)}),this._queuePlayer(e,n),n}},{key:"_buildPlayer",value:function(e,t,r){return this._driver.animate(e,this._normalizeKeyframes(t.keyframes),t.duration,t.delay,t.easing,r)}},{key:"_normalizeKeyframes",value:function(e){var _this6=this,t=[],r=[];if(e.forEach(function(n){var a={};Object.keys(n).forEach(function(o){var l=o,u=n[o];"offset"!=o&&(l=_this6._normalizer.normalizePropertyName(o,t),u=_this6._normalizer.normalizeStyleValue(o,l,n[o],t)),a[l]=u}),r.push(a)}),t.length){var n="\n - ";throw new Error("Unable to animate due to the following errors:"+n+t.join(n))}return r}},{key:"_queuePlayer",value:function(e,t){this._queuedAnimations.push({element:e,player:t}),t.init();var n=getOrSetAsInMap(this._activeElementAnimations,e,[]);n.push(t)}},{key:"triggerAnimations",value:function(){for(var _this7=this;this._queuedAnimations.length;){var _queuedAnimations$shi=this._queuedAnimations.shift(),e=_queuedAnimations$shi.player;_queuedAnimations$shi.element;e.hasStarted()||e.play()}this._queuedRemovals.forEach(function(e){if(!_this7._flaggedInserts.has(e)){for(var r=void 0,t=e;t=t.parentNode;){var n=_this7._activeElementAnimations.get(t);if(n){r=n;break}}r?optimizeGroupPlayer(r).onDone(function(){return remove(e)}):e.parentNode&&remove(e)}}),this._queuedRemovals=[],this._flaggedInserts.clear()}}]),DomAnimationTransitionEngine}(_core.ɵTransitionEngine);DomAnimationTransitionEngine.decorators=[{type:_core.Injectable}],DomAnimationTransitionEngine.ctorParameters=function(){return[{type:AnimationDriver},{type:AnimationStyleNormalizer}]};var WebAnimationsPlayer=function(){function WebAnimationsPlayer(e,t,r){var _this8=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];_classCallCheck(this,WebAnimationsPlayer),this.element=e,this.keyframes=t,this.options=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this._duration=r.duration,this._delay=r.delay||0,this.time=this._duration+this._delay,this.previousStyles={},n.forEach(function(a){var o=a._captureStyles();Object.keys(o).forEach(function(l){return _this8.previousStyles[l]=o[l]})})}return _createClass(WebAnimationsPlayer,[{key:"_onFinish",value:function(){this._finished||(this._finished=!0,this._onDoneFns.forEach(function(e){return e()}),this._onDoneFns=[])}},{key:"init",value:function(){var _this9=this;if(!this._initialized){this._initialized=!0;var e=this.keyframes.map(function(n){var a={};return Object.keys(n).forEach(function(o){var u=n[o];u==_core.AUTO_STYLE&&(u=_computeStyle(_this9.element,o)),void 0!=u&&(a[o]=u)}),a}),t=Object.keys(this.previousStyles);if(t.length){var n=e[0],a=[];if(t.forEach(function(o){null!=n[o]&&a.push(o),n[o]=_this9.previousStyles[o]}),a.length){var r;!function(){var o=_this9,_loop=function(){var l=e[r];a.forEach(function(u){l[u]=_computeStyle(o.element,u)})};for(r=1;r<e.length;r++)_loop()}()}}this._player=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=_copyKeyframeStyles(e[e.length-1]),this._resetDomPlayerState(),this._player.addEventListener("finish",function(){return _this9._onFinish()})}}},{key:"_triggerWebAnimation",value:function(e,t,r){return e.animate(t,r)}},{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"play",value:function(){this.init(),this.hasStarted()||(this._onStartFns.forEach(function(e){return e()}),this._onStartFns=[],this._started=!0),this._player.play()}},{key:"pause",value:function(){this.init(),this._player.pause()}},{key:"finish",value:function(){this.init(),this._onFinish(),this._player.finish()}},{key:"reset",value:function(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}},{key:"_resetDomPlayerState",value:function(){this._player&&this._player.cancel()}},{key:"restart",value:function(){this.reset(),this.play()}},{key:"hasStarted",value:function(){return this._started}},{key:"destroy",value:function(){this._destroyed||(this._resetDomPlayerState(),this._onFinish(),this._destroyed=!0,this._onDestroyFns.forEach(function(e){return e()}),this._onDestroyFns=[])}},{key:"setPosition",value:function(e){this._player.currentTime=e*this.time}},{key:"getPosition",value:function(){return this._player.currentTime/this.time}},{key:"_captureStyles",value:function(){var _this10=this,e={};return this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(function(t){"offset"!=t&&(e[t]=_this10._finished?_this10._finalKeyframe[t]:_computeStyle(_this10.element,t))}),e}},{key:"domPlayer",get:function(){return this._player}}]),WebAnimationsPlayer}(),WebAnimationsDriver=function(){function WebAnimationsDriver(){_classCallCheck(this,WebAnimationsDriver)}return _createClass(WebAnimationsDriver,[{key:"animate",value:function(e,t,r,n,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],l={duration:r,delay:n,fill:"forwards"};a&&(l.easing=a);var u=o.filter(function(d){return d instanceof WebAnimationsPlayer});return new WebAnimationsPlayer(e,t,l,u)}}]),WebAnimationsDriver}(),AnimationModule=function AnimationModule(){_classCallCheck(this,AnimationModule)};AnimationModule.decorators=[{type:_core.NgModule,args:[{providers:[{provide:AnimationDriver,useFactory:resolveDefaultAnimationDriver},{provide:AnimationStyleNormalizer,useClass:WebAnimationsStyleNormalizer},{provide:_core.ɵTransitionEngine,useClass:DomAnimationTransitionEngine}]}]}],AnimationModule.ctorParameters=function(){return[]};var ONE_SECOND=1e3,AUTO_STYLE$1="*",AnimationTimelineContext=function(){function AnimationTimelineContext(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,AnimationTimelineContext),this.errors=e,this.timelines=t,this.previousNode={},this.subContextCount=0,this.currentTimeline=r||new TimelineBuilder(0),t.push(this.currentTimeline)}return _createClass(AnimationTimelineContext,[{key:"createSubContext",value:function(){var e=new AnimationTimelineContext(this.errors,this.timelines,this.currentTimeline.fork());return e.previousNode=this.previousNode,e.currentAnimateTimings=this.currentAnimateTimings,this.subContextCount++,e}},{key:"transformIntoNewTimeline",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.currentTimeline=this.currentTimeline.fork(e),this.timelines.push(this.currentTimeline),this.currentTimeline}},{key:"incrementTime",value:function(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}}]),AnimationTimelineContext}(),AnimationTimelineVisitor=function(){function AnimationTimelineVisitor(){_classCallCheck(this,AnimationTimelineVisitor)}return _createClass(AnimationTimelineVisitor,[{key:"buildKeyframes",value:function(e,t,r){var n=new AnimationTimelineContext([],[]);n.currentTimeline.setStyles(t),visitAnimationNode(this,e,n);var a=copyStyles(r,!0);0==Object.keys(n.currentTimeline.getFinalKeyframe()).length&&n.currentTimeline.properties.forEach(function(l){var u=a[l];null==u&&(a[l]=AUTO_STYLE$1)}),n.currentTimeline.setStyles(a);var o=[];return n.timelines.forEach(function(l){l.hasStyling()&&o.push(l.buildKeyframes())}),0==o.length&&o.push(createTimelineInstruction([],0,0,"")),o}},{key:"visitState",value:function(){}},{key:"visitTransition",value:function(){}},{key:"visitSequence",value:function(e,t){var _this11=this,r=t.subContextCount;6==t.previousNode.type&&(t.currentTimeline.forwardFrame(),t.currentTimeline.snapshotCurrentStyles()),e.steps.forEach(function(n){return visitAnimationNode(_this11,n,t)}),t.subContextCount>r&&t.transformIntoNewTimeline(),t.previousNode=e}},{key:"visitGroup",value:function(e,t){var _this12=this,r=[],n=t.currentTimeline.currentTime;e.steps.forEach(function(a){var o=t.createSubContext();visitAnimationNode(_this12,a,o),n=Math.max(n,o.currentTimeline.currentTime),r.push(o.currentTimeline)}),r.forEach(function(a){return t.currentTimeline.mergeTimelineCollectedStyles(a)}),t.transformIntoNewTimeline(n),t.previousNode=e}},{key:"visitAnimate",value:function(e,t){var r=e.timings.hasOwnProperty("duration")?e.timings:parseTimeExpression(e.timings,t.errors);t.currentAnimateTimings=r,r.delay&&(t.incrementTime(r.delay),t.currentTimeline.snapshotCurrentStyles());var n=e.styles?e.styles.type:-1;5==n?this.visitKeyframeSequence(e.styles,t):(t.incrementTime(r.duration),6==n&&this.visitStyle(e.styles,t)),t.currentAnimateTimings=null,t.previousNode=e}},{key:"visitStyle",value:function(e,t){t.currentAnimateTimings||4!=t.previousNode.type||t.currentTimeline.forwardFrame();var r=normalizeStyles(new _core.AnimationStyles(e.styles)),n=t.currentAnimateTimings&&t.currentAnimateTimings.easing;n&&(r.easing=n),t.currentTimeline.setStyles(r),t.previousNode=e}},{key:"visitKeyframeSequence",value:function(e,t){var r=1,n=e.steps.length-1,a=e.steps[0],o=0,l=a.styles.find(function(c){return 0<=c.offset});l||(o=r/n);var u=t.currentTimeline.duration,d=t.currentAnimateTimings.duration,y=t.createSubContext(),f=y.currentTimeline;f.easing=t.currentAnimateTimings.easing,e.steps.forEach(function(c,_){var h=normalizeStyles(new _core.AnimationStyles(c.styles)),g=l?h.offset:_==n?r:_*o;f.forwardTime(g*d),f.setStyles(h)}),t.currentTimeline.mergeTimelineCollectedStyles(f),t.transformIntoNewTimeline(u+d),t.previousNode=e}}]),AnimationTimelineVisitor}(),TimelineBuilder=function(){function TimelineBuilder(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,TimelineBuilder),this.startTime=e,this._globalTimelineStyles=t,this.duration=0,this.easing="",this._keyframes=new Map,this._styleSummary={},this._backFill={},this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles),this._loadKeyframe()}return _createClass(TimelineBuilder,[{key:"hasStyling",value:function(){return 1<this._keyframes.size}},{key:"fork",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new TimelineBuilder(e||this.currentTime,this._globalTimelineStyles)}},{key:"_loadKeyframe",value:function(){this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}},{key:"forwardFrame",value:function(){this.duration++,this._loadKeyframe()}},{key:"forwardTime",value:function(e){this.duration=e,this._loadKeyframe()}},{key:"_updateStyle",value:function(e,t){"easing"!=e&&(this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t})}},{key:"setStyles",value:function(e){var _this13=this;Object.keys(e).forEach(function(t){if("offset"!==t){var r=e[t];_this13._currentKeyframe[t]=r,"easing"===t||_this13._localTimelineStyles[t]||(_this13._backFill[t]=_this13._globalTimelineStyles[t]||AUTO_STYLE$1),_this13._updateStyle(t,r)}}),Object.keys(this._localTimelineStyles).forEach(function(t){_this13._currentKeyframe.hasOwnProperty(t)||(_this13._currentKeyframe[t]=_this13._localTimelineStyles[t])})}},{key:"snapshotCurrentStyles",value:function(){copyStyles(this._localTimelineStyles,!1,this._currentKeyframe)}},{key:"getFinalKeyframe",value:function(){return this._keyframes.get(this.duration)}},{key:"mergeTimelineCollectedStyles",value:function(e){var _this14=this;Object.keys(e._styleSummary).forEach(function(t){var r=_this14._styleSummary[t],n=e._styleSummary[t];(!r||n.time>r.time)&&_this14._updateStyle(t,n.value)})}},{key:"buildKeyframes",value:function(){var _this15=this,e=[];if(0==this.duration){var t=this.getFinalKeyframe(),r=copyStyles(t,!0);r.offset=0,e.push(r);var n=copyStyles(t,!0);n.offset=1,e.push(n)}else this._keyframes.forEach(function(t,r){var n=copyStyles(t,!0);n.offset=r/_this15.duration,e.push(n)});return createTimelineInstruction(e,this.duration,this.startTime,this.easing)}},{key:"currentTime",get:function(){return this.startTime+this.duration}},{key:"properties",get:function(){var e=[];for(var t in this._currentKeyframe)e.push(t);return e}}]),TimelineBuilder}(),AnimationValidatorVisitor=function(){function AnimationValidatorVisitor(){_classCallCheck(this,AnimationValidatorVisitor)}return _createClass(AnimationValidatorVisitor,[{key:"validate",value:function(e){var t=new AnimationValidatorContext;return visitAnimationNode(this,e,t),t.errors}},{key:"visitState",value:function(){}},{key:"visitTransition",value:function(){}},{key:"visitSequence",value:function(e,t){var _this16=this;e.steps.forEach(function(r){return visitAnimationNode(_this16,r,t)})}},{key:"visitGroup",value:function(e,t){var _this17=this,r=t.currentTime,n=0;e.steps.forEach(function(a){t.currentTime=r,visitAnimationNode(_this17,a,t),n=Math.max(n,t.currentTime)}),t.currentTime=n}},{key:"visitAnimate",value:function(e,t){t.currentAnimateTimings=e.timings=parseTimeExpression(e.timings,t.errors);var r=e.styles&&e.styles.type;5==r?this.visitKeyframeSequence(e.styles,t):(t.currentTime+=t.currentAnimateTimings.duration+t.currentAnimateTimings.delay,6==r&&this.visitStyle(e.styles,t)),t.currentAnimateTimings=null}},{key:"visitStyle",value:function(e,t){var r=normalizeStyles(new _core.AnimationStyles(e.styles)),n=t.currentAnimateTimings,a=t.currentTime,o=t.currentTime;n&&0<o&&(o-=n.duration+n.delay),Object.keys(r).forEach(function(l){var u=t.collectedStyles[l],d=!0;u&&(o!=a&&o>=u.startTime&&a<=u.endTime&&(t.errors.push('The CSS property "'+l+'" that exists between the times of "'+u.startTime+'ms" and "'+u.endTime+'ms" is also being animated in a parallel animation between the times of "'+o+'ms" and "'+a+'ms"'),d=!1),o=u.startTime),d&&(t.collectedStyles[l]={startTime:o,endTime:a})})}},{key:"visitKeyframeSequence",value:function(e,t){var _this18=this,r=0,n=[],a=!1,o=!1,l=0;e.steps.forEach(function(_){var h=normalizeStyles(new _core.AnimationStyles(_.styles)),g=0;h.hasOwnProperty("offset")&&(r++,g=h.offset),o=o||0>g||1<g,a=a||g<l,l=g,n.push(g)}),o&&t.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),a&&t.errors.push("Please ensure that all keyframe offsets are in order");var u=e.steps.length,d=0;0<r&&r<u?t.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==r&&(d=1/u);var f=t.currentTime,c=t.currentAnimateTimings.duration;e.steps.forEach(function(_,h){var g=0<d?h==u-1?1:d*h:n[h],T=g*c;t.currentTime=f+t.currentAnimateTimings.delay+T,t.currentAnimateTimings.duration=T,_this18.visitStyle(_,t)})}}]),AnimationValidatorVisitor}(),AnimationValidatorContext=function AnimationValidatorContext(){_classCallCheck(this,AnimationValidatorContext),this.errors=[],this.currentTime=0,this.collectedStyles={}},Animation=function(){function Animation(e){_classCallCheck(this,Animation);var t=Array.isArray(e)?sequence(e):e,r=validateAnimationSequence(t);if(r.length){var n="animation validation failed:\n"+r.join("\n");throw new Error(n)}this._animationAst=t}return _createClass(Animation,[{key:"buildTimelines",value:function(e,t){var r=Array.isArray(e)?normalizeStyles(new _core.AnimationStyles(e)):e,n=Array.isArray(t)?normalizeStyles(new _core.AnimationStyles(t)):t;return buildAnimationKeyframes(this._animationAst,r,n)}},{key:"create",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=this.buildTimelines(r,n),o=e.get(AnimationDriver),l=e.get(AnimationStyleNormalizer),u=new DomAnimationTransitionEngine(o,l);return u.process(t,a)}}]),Animation}(),ANY_STATE="*",AnimationTransitionFactory=function(){function AnimationTransitionFactory(e,t,r,n){_classCallCheck(this,AnimationTransitionFactory),this._triggerName=e,this.matchFns=r,this._stateStyles=n,this._animationAst=t.animation}return _createClass(AnimationTransitionFactory,[{key:"match",value:function(e,t){if(oneOrMoreTransitionsMatch(this.matchFns,e,t)){var r=this._stateStyles["*"]||{},n=this._stateStyles[e]||r,a=this._stateStyles[t]||r,o=buildAnimationKeyframes(this._animationAst,n,a);return createTransitionInstruction(this._triggerName,"void"===t,n,a,o)}}}]),AnimationTransitionFactory}(),AnimationTrigger=function(){function AnimationTrigger(e,t,r){var _this19=this;_classCallCheck(this,AnimationTrigger),this.name=e,this._transitionAsts=r,this.transitionFactories=[],this.states={},Object.keys(t).forEach(function(a){_this19.states[a]=copyStyles(t[a],!1)});var n=[];if(r.forEach(function(a){var o=parseTransitionExpr(a.expr,n),l=validateAnimationSequence(a);l.length?n.push.apply(n,_toConsumableArray(l)):_this19.transitionFactories.push(new AnimationTransitionFactory(_this19.name,a,o,t))}),n.length){var a="\n - ";throw new Error("Animation parsing for the "+e+" trigger have failed:"+a+n.join(a))}}return _createClass(AnimationTrigger,[{key:"matchTransition",value:function(e,t){for(var n,r=0;r<this.transitionFactories.length;r++)if(n=this.transitionFactories[r].match(e,t))return n;return null}}]),AnimationTrigger}(),AnimationTriggerContext=function AnimationTriggerContext(){_classCallCheck(this,AnimationTriggerContext),this.errors=[],this.states={},this.transitions=[]},AnimationTriggerVisitor=function(){function AnimationTriggerVisitor(){_classCallCheck(this,AnimationTriggerVisitor)}return _createClass(AnimationTriggerVisitor,[{key:"buildTrigger",value:function(e,t){var _this20=this,r=new AnimationTriggerContext;return t.forEach(function(n){return visitAnimationNode(_this20,n,r)}),new AnimationTrigger(e,r.states,r.transitions)}},{key:"visitState",value:function(e,t){t.states[e.name]=normalizeStyles(new _core.AnimationStyles(e.styles.styles))}},{key:"visitTransition",value:function(e,t){t.transitions.push(e)}},{key:"visitSequence",value:function(){}},{key:"visitGroup",value:function(){}},{key:"visitAnimate",value:function(){}},{key:"visitStyle",value:function(){}},{key:"visitKeyframeSequence",value:function(){}}]),AnimationTriggerVisitor}();exports.AnimationModule=AnimationModule,exports.Animation=Animation,exports.AUTO_STYLE=AUTO_STYLE$1,exports.animate=animate,exports.group=group,exports.keyframes=keyframes,exports.sequence=sequence,exports.state=state,exports.style=style,exports.transition=transition,exports.AnimationTrigger=AnimationTrigger,exports.trigger=trigger,exports.ɵa=resolveDefaultAnimationDriver,exports.ɵd=AnimationStyleNormalizer,exports.ɵe=WebAnimationsStyleNormalizer,exports.ɵc=AnimationDriver,exports.ɵf=DomAnimationTransitionEngine});