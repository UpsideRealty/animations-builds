/**
 * @license Angular v4.1.0-beta.0-c933b75
 * (c) 2010-2017 Google, Inc. https://angular.io/
 * License: MIT
 */
!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@angular/animations")):"function"==typeof define&&define.amd?define(["exports","@angular/animations"],factory):factory((global.ng=global.ng||{},global.ng.animations=global.ng.animations||{},global.ng.animations.browser=global.ng.animations.browser||{}),global.ng.animations)}(this,function(exports,_angular_animations){"use strict";function resolveTimingValue(timings,errors,allowNegativeValues){return timings.hasOwnProperty("duration")?timings:parseTimeExpression(timings,errors,allowNegativeValues)}function parseTimeExpression(exp,errors,allowNegativeValues){var duration,regex=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,delay=0,easing=null;if("string"==typeof exp){var matches=exp.match(regex);if(null===matches)return errors.push('The provided timing value "'+exp+'" is invalid.'),{duration:0,delay:0,easing:null};var durationMatch=parseFloat(matches[1]),durationUnit=matches[2];"s"==durationUnit&&(durationMatch*=ONE_SECOND),duration=Math.floor(durationMatch);var delayMatch=matches[3],delayUnit=matches[4];if(null!=delayMatch){var delayVal=parseFloat(delayMatch);null!=delayUnit&&"s"==delayUnit&&(delayVal*=ONE_SECOND),delay=Math.floor(delayVal)}var easingVal=matches[5];easingVal&&(easing=easingVal)}else duration=exp;if(!allowNegativeValues){var containsErrors=!1,startIndex=errors.length;duration<0&&(errors.push("Duration values below 0 are not allowed for this animation step."),containsErrors=!0),delay<0&&(errors.push("Delay values below 0 are not allowed for this animation step."),containsErrors=!0),containsErrors&&errors.splice(startIndex,0,'The provided timing value "'+exp+'" is invalid.')}return{duration:duration,delay:delay,easing:easing}}function copyObj(obj,destination){return void 0===destination&&(destination={}),Object.keys(obj).forEach(function(prop){destination[prop]=obj[prop]}),destination}function normalizeStyles(styles){var normalizedStyles={};return Array.isArray(styles)?styles.forEach(function(data){return copyStyles(data,!1,normalizedStyles)}):copyStyles(styles,!1,normalizedStyles),normalizedStyles}function copyStyles(styles,readPrototype,destination){if(void 0===destination&&(destination={}),readPrototype)for(var prop in styles)destination[prop]=styles[prop];else copyObj(styles,destination);return destination}function setStyles(element,styles){element.style&&Object.keys(styles).forEach(function(prop){return element.style[prop]=styles[prop]})}function eraseStyles(element,styles){element.style&&Object.keys(styles).forEach(function(prop){element.style[prop]=""})}function normalizeAnimationEntry(steps){return Array.isArray(steps)?1==steps.length?steps[0]:_angular_animations.sequence(steps):steps}function validateStyleLocals(value,locals,errors){"string"==typeof value&&(matchAndValidate(SIMPLE_STYLE_INTERPOLATION_REGEX,1,0,value,locals,errors),matchAndValidate(ADVANCED_STYLE_INTERPOLATION_REGEX,2,1,value,locals,errors))}function matchAndValidate(regex,prefixLength,suffixLength,str,locals,errors){var matches=str.toString().match(regex);matches&&matches.forEach(function(varName){varName=varName.substring(prefixLength,varName.length-suffixLength),locals.hasOwnProperty(varName)||errors.push("Unable to resolve the local animation variable $"+varName+" in the given list of values")})}function interpolateStyleLocals(value,locals,errors){var str=value.toString();return str=matchAndReplace(SIMPLE_STYLE_INTERPOLATION_REGEX,1,0,str,locals,errors),str=matchAndReplace(ADVANCED_STYLE_INTERPOLATION_REGEX,2,1,str,locals,errors)}function matchAndReplace(regex,prefixLength,suffixLength,str,locals,errors){return str.replace(regex,function(varName){varName=varName.substring(prefixLength,varName.length-suffixLength);var localVal=locals[varName];return localVal===!0&&(errors.push("Please provide a value for the animation variable $"+varName),localVal=""),localVal.toString()})}function iteratorToArray(iterator){for(var arr=[],item=iterator.next();!item.done;)arr.push(item.value),item=iterator.next();return arr}/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
function optimizeGroupPlayer(players){switch(players.length){case 0:return new _angular_animations.NoopAnimationPlayer;case 1:return players[0];default:return new _angular_animations.ÉµAnimationGroupPlayer(players)}}function normalizeKeyframes(driver,normalizer,element,keyframes,preStyles,postStyles){var errors=[],normalizedKeyframes=[],previousOffset=-1,previousKeyframe=null;if(keyframes.forEach(function(kf){var offset=kf.offset,isSameOffset=offset==previousOffset,normalizedKeyframe=isSameOffset?previousKeyframe:{};Object.keys(kf).forEach(function(prop){var normalizedProp=prop,normalizedValue=kf[prop];normalizedValue==_angular_animations.PRE_STYLE?normalizedValue=preStyles[prop]:normalizedValue==_angular_animations.AUTO_STYLE?normalizedValue=postStyles[prop]:"offset"!=prop&&(normalizedProp=normalizer.normalizePropertyName(prop,errors),normalizedValue=normalizer.normalizeStyleValue(prop,normalizedProp,kf[prop],errors)),normalizedKeyframe[normalizedProp]=normalizedValue}),isSameOffset||normalizedKeyframes.push(normalizedKeyframe),previousKeyframe=normalizedKeyframe,previousOffset=offset}),errors.length){var LINE_START="\n - ";throw new Error("Unable to animate due to the following errors:"+LINE_START+errors.join(LINE_START))}return normalizedKeyframes}function listenOnPlayer(player,eventName,event,callback){switch(eventName){case"start":player.onStart(function(){callback(event&&copyAnimationEvent(event,"start",player.totalTime))});break;case"done":player.onDone(function(){callback(event&&copyAnimationEvent(event,"done",player.totalTime))});break;case"destroy":player.onDestroy(function(){callback(event&&copyAnimationEvent(event,"destroy",player.totalTime))})}}function copyAnimationEvent(e,phaseName,totalTime){return makeAnimationEvent(e.element,e.triggerName,e.fromState,e.toState,phaseName||e.phaseName,void 0==totalTime?e.totalTime:totalTime)}function makeAnimationEvent(element,triggerName,fromState,toState,phaseName,totalTime){return void 0===phaseName&&(phaseName=null),void 0===totalTime&&(totalTime=null),{element:element,triggerName:triggerName,fromState:fromState,toState:toState,phaseName:phaseName,totalTime:totalTime}}function getOrSetAsInMap(map,key,defaultValue){var value;return map instanceof Map?(value=map.get(key),value||map.set(key,value=defaultValue)):(value=map[key],value||(value=map[key]=defaultValue)),value}/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
function visitAnimationNode(visitor,node,context){switch(node.type){case 0:return visitor.visitTrigger(node,context);case 1:return visitor.visitState(node,context);case 2:return visitor.visitTransition(node,context);case 3:return visitor.visitSequence(node,context);case 4:return visitor.visitGroup(node,context);case 5:return visitor.visitAnimate(node,context);case 6:return visitor.visitKeyframeSequence(node,context);case 7:return visitor.visitStyle(node,context);case 8:return visitor.visitReference(node,context);case 9:return visitor.visitAnimateChild(node,context);case 10:return visitor.visitQuery(node,context);case 11:return visitor.visitStagger(node,context);case 12:return visitor.visitWait(node,context);default:throw new Error("Unable to resolve animation metadata node #"+node.type)}}function parseTransitionExpr(transitionValue,errors){var expressions=[];return"string"==typeof transitionValue?transitionValue.split(/\s*,\s*/).forEach(function(str){return parseInnerTransitionStr(str,expressions,errors)}):expressions.push(transitionValue),expressions}function parseInnerTransitionStr(eventStr,expressions,errors){":"==eventStr[0]&&(eventStr=parseAnimationAlias(eventStr,errors));var match=eventStr.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==match||match.length<4)return errors.push('The provided transition expression "'+eventStr+'" is not supported'),expressions;var fromState=match[1],separator=match[2],toState=match[3];expressions.push(makeLambdaFromStates(fromState,toState));var isFullAnyStateExpr=fromState==ANY_STATE&&toState==ANY_STATE;"<"!=separator[0]||isFullAnyStateExpr||expressions.push(makeLambdaFromStates(toState,fromState))}function parseAnimationAlias(alias,errors){switch(alias){case":enter":return"void => *";case":leave":return"* => void";default:return errors.push('The transition alias value "'+alias+'" is not supported'),"* => *"}}function makeLambdaFromStates(lhs,rhs){return function(fromState,toState){var lhsMatch=lhs==ANY_STATE||lhs==fromState,rhsMatch=rhs==ANY_STATE||rhs==toState;return lhsMatch&&rhsMatch}}/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
function buildAnimationAst(metadata,errors){return(new AnimationAstBuilderVisitor).build(metadata,errors)}function normalizeSelector(selector){var hasAmpersand=!!selector.split(/\s*,\s*/).find(function(token){return"&"==token});return hasAmpersand&&(selector=selector.replace(/\s*&\s*,?/g,"")),selector=selector.replace(ENTER_TOKEN_REGEX,ENTER_SELECTOR).replace(LEAVE_TOKEN_REGEX,LEAVE_SELECTOR).replace(/@\*/g,NG_TRIGGER_SELECTOR).replace(/@\w+/g,function(match){return NG_TRIGGER_SELECTOR+"-"+match.substr(1)}).replace(/:animating/g,NG_ANIMATING_SELECTOR),[selector,hasAmpersand]}function normalizeLocals(obj){return obj?copyObj(obj):null}function countArgs(args){return args.reduce(function(count,arg){return(null!=arg?1:0)+count},0)}function consumeOffset(styles){var offset=null;if("string"==typeof styles)return offset;if(Array.isArray(styles))styles.forEach(function(styleTuple){if(isObject(styleTuple)&&styleTuple.hasOwnProperty("offset")){var obj=styleTuple;offset=parseFloat(obj.offset),delete obj.offset}});else if(isObject(styles)&&styles.hasOwnProperty("offset")){var obj=styles;offset=parseFloat(obj.offset),delete obj.offset}return offset}function isObject(value){return!Array.isArray(value)&&"object"==typeof value}function constructTimingAst(value,errors){var timings=null;if(value.hasOwnProperty("duration"))timings=value;else if("number"==typeof value){resolveTimingValue(value,errors).duration;return new AnimationTimingAst(value,0,"")}var strValue=value,isDynamic=strValue.split(/\s+/).some(function(v){return"$"==v.charAt(0)});return isDynamic?new DynamicAnimationTimingAst(strValue):(timings=timings||resolveTimingValue(strValue,errors),new AnimationTimingAst(timings.duration,timings.delay,timings.easing))}/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
function createTimelineInstruction(element,keyframes,preStyleProps,postStyleProps,duration,delay,easing,subTimeline){return void 0===subTimeline&&(subTimeline=!1),{type:1,element:element,keyframes:keyframes,preStyleProps:preStyleProps,postStyleProps:postStyleProps,duration:duration,delay:delay,totalTime:duration+delay,easing:easing,subTimeline:subTimeline}}/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
function buildAnimationTimelines(rootElement,ast,startingStyles,finalStyles,locals,subInstructions,errors){return void 0===startingStyles&&(startingStyles={}),void 0===finalStyles&&(finalStyles={}),(new AnimationTimelineBuilderVisitor).buildKeyframes(rootElement,ast,startingStyles,finalStyles,locals,subInstructions,errors)}function invokeQuery(rootElement,selector,multi,includeSelf){var results=[];if(includeSelf&&results.push(rootElement),multi)results.push.apply(results,rootElement.querySelectorAll(selector));else if(0==results.length){var elm=rootElement.querySelector(selector);elm&&results.push(elm)}return results}function roundOffset(offset,decimalPoints){void 0===decimalPoints&&(decimalPoints=3);var mult=Math.pow(10,decimalPoints-1);return Math.round(offset*mult)/mult}function flattenStyles(input,allStyles){var allProperties,styles={};return input.forEach(function(token){"*"===token?(allProperties=allProperties||Object.keys(allStyles),allProperties.forEach(function(prop){styles[prop]=_angular_animations.AUTO_STYLE})):copyStyles(token,!1,styles)}),styles}function makeBooleanMap(keys){var map={};return keys.forEach(function(key){return map[key]=!0}),map}function dashCaseToCamelCase(input){return input.replace(DASH_CASE_REGEXP,function(){for(var m=[],_i=0;_i<arguments.length;_i++)m[_i]=arguments[_i];return m[1].toUpperCase()})}/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
function createTransitionInstruction(element,triggerName,fromState,toState,isRemovalTransition,fromStyles,toStyles,timelines,queriedElements,preStyleProps,postStyleProps){return{type:0,element:element,triggerName:triggerName,isRemovalTransition:isRemovalTransition,fromState:fromState,fromStyles:fromStyles,toState:toState,toStyles:toStyles,timelines:timelines,queriedElements:queriedElements,preStyleProps:preStyleProps,postStyleProps:postStyleProps}}function oneOrMoreTransitionsMatch(matchFns,currentState,nextState){return matchFns.some(function(fn){return fn(currentState,nextState)})}/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
function buildTrigger(name,ast){return new AnimationTrigger(name,ast)}function createFallbackTransition(triggerName,states){var matchers=[function(fromState,toState){return!0}],animation=new AnimationSequenceAst([]),transition=new AnimationTransitionAst(matchers,animation,{});return new AnimationTransitionFactory(triggerName,transition,states)}function deleteOrUnsetInMap(map,key,value){var currentValues;if(map instanceof Map){if(currentValues=map.get(key)){if(currentValues.length){var index=currentValues.indexOf(value);currentValues.splice(index,1)}0==currentValues.length&&map.delete(key)}}else if(currentValues=map[key]){if(currentValues.length){var index=currentValues.indexOf(value);currentValues.splice(index,1)}0==currentValues.length&&delete map[key]}return currentValues}function normalizeTriggerValue(value){switch(typeof value){case"boolean":return value?"1":"0";default:return value?value.toString():null}}function isElementNode(node){return node&&1===node.nodeType}function isTriggerEventValid(eventName){return"start"==eventName||"done"==eventName}function cloakElement(element,value){var oldValue=element.style.display;return element.style.display=null!=value?value:"none",oldValue}function filterNodeClasses(rootElement,selector){var rootElements=[],cursor=rootElement,nextCursor=null;do if(nextCursor=cursor.querySelector(selector))for(;nextCursor&&nextCursor.matches(selector);)if(rootElements.push(nextCursor),nextCursor=nextCursor.nextElementSibling)cursor=nextCursor;else{if(cursor=cursor.parentElement,!cursor)break;nextCursor=cursor=cursor.nextElementSibling}else{if(cursor=cursor.parentElement,!cursor)break;nextCursor=cursor=cursor.nextElementSibling}while(nextCursor&&nextCursor!==rootElement);return rootElements}function cloakAndComputeStyles(driver,elements,elementPropsMap,defaultStyle){var cloakVals=elements.map(function(element){return cloakElement(element)}),valuesMap=new Map;return elementPropsMap.forEach(function(props,element){var styles={};props.forEach(function(prop){styles[prop]=driver.computeStyle(element,prop,defaultStyle)}),valuesMap.set(element,styles)}),elements.forEach(function(element,i){return cloakElement(element,cloakVals[i])}),valuesMap}function listToArray(list){var arr=[];return arr.push.apply(arr,list),arr}function parseCustomCommand(command){var separatorPos=command.indexOf(":"),id=command.substring(1,separatorPos),action=command.substr(separatorPos+1);return[id,action]}function makeAnimationEvent$1(element,triggerName,fromState,toState,phaseName,totalTime){return{element:element,triggerName:triggerName,fromState:fromState,toState:toState,phaseName:phaseName,totalTime:totalTime}}function makeStorageProp(property){return"_@_"+property}function _computeStyle(element,prop){return window.getComputedStyle(element)[prop]}function supportsWebAnimations(){return"undefined"!=typeof Element&&"function"==typeof Element.prototype.animate}var __extends=function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},NoopAnimationDriver=function(){function NoopAnimationDriver(){}return NoopAnimationDriver.prototype.computeStyle=function(element,prop,defaultValue){return defaultValue||""},NoopAnimationDriver.prototype.animate=function(element,keyframes,duration,delay,easing,previousPlayers){return void 0===previousPlayers&&(previousPlayers=[]),new _angular_animations.NoopAnimationPlayer},NoopAnimationDriver}(),AnimationDriver=function(){function AnimationDriver(){}return AnimationDriver}();AnimationDriver.NOOP=new NoopAnimationDriver;/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
var AnimationEngine=function(){function AnimationEngine(){}return AnimationEngine.prototype.registerTrigger=function(componentId,namespaceId,hostElement,name,metadata){},AnimationEngine.prototype.onInsert=function(namespaceId,element,parent,insertBefore){},AnimationEngine.prototype.onRemove=function(namespaceId,element,context){},AnimationEngine.prototype.setProperty=function(namespaceId,element,property,value){},AnimationEngine.prototype.listen=function(namespaceId,element,eventName,eventPhase,callback){},AnimationEngine.prototype.flush=function(){},AnimationEngine.prototype.destroy=function(namespaceId,context){},AnimationEngine}(),ONE_SECOND=1e3,ENTER_CLASSNAME="ng-enter",LEAVE_CLASSNAME="ng-leave",ENTER_SELECTOR=".ng-enter",LEAVE_SELECTOR=".ng-leave",NG_TRIGGER_CLASSNAME="ng-trigger",NG_TRIGGER_SELECTOR=".ng-trigger",NG_ANIMATING_CLASSNAME="ng-animating",NG_ANIMATING_SELECTOR=".ng-animating",SIMPLE_STYLE_INTERPOLATION_REGEX=/\$\w+/g,ADVANCED_STYLE_INTERPOLATION_REGEX=/\$\{([-\w\s]+)\}/g,AnimationAst=function(){function AnimationAst(){}return AnimationAst.prototype.visit=function(ast,context){},AnimationAst}(),AnimationTriggerAst=function(_super){function AnimationTriggerAst(name,states,transitions){var _this=_super.call(this)||this;return _this.name=name,_this.states=states,_this.transitions=transitions,_this.queryCount=0,_this.depCount=0,_this}return __extends(AnimationTriggerAst,_super),AnimationTriggerAst.prototype.visit=function(visitor,context){return visitor.visitTrigger(this,context)},AnimationTriggerAst}(AnimationAst),AnimationStateAst=function(_super){function AnimationStateAst(name,style$$1){var _this=_super.call(this)||this;return _this.name=name,_this.style=style$$1,_this}return __extends(AnimationStateAst,_super),AnimationStateAst.prototype.visit=function(visitor,context){return visitor.visitState(this,context)},AnimationStateAst}(AnimationAst),AnimationTransitionAst=function(_super){function AnimationTransitionAst(matchers,animation,locals){var _this=_super.call(this)||this;return _this.matchers=matchers,_this.animation=animation,_this.locals=locals,_this.queryCount=0,_this.depCount=0,_this}return __extends(AnimationTransitionAst,_super),AnimationTransitionAst.prototype.visit=function(visitor,context){return visitor.visitTransition(this,context)},AnimationTransitionAst}(AnimationAst),AnimationSequenceAst=function(_super){function AnimationSequenceAst(steps){var _this=_super.call(this)||this;return _this.steps=steps,_this}return __extends(AnimationSequenceAst,_super),AnimationSequenceAst.prototype.visit=function(visitor,context){return visitor.visitSequence(this,context)},AnimationSequenceAst}(AnimationAst),AnimationGroupAst=function(_super){function AnimationGroupAst(steps){var _this=_super.call(this)||this;return _this.steps=steps,_this}return __extends(AnimationGroupAst,_super),AnimationGroupAst.prototype.visit=function(visitor,context){return visitor.visitGroup(this,context)},AnimationGroupAst}(AnimationAst),AnimationAnimateAst=function(_super){function AnimationAnimateAst(timings,style$$1){var _this=_super.call(this)||this;return _this.timings=timings,_this.style=style$$1,_this}return __extends(AnimationAnimateAst,_super),AnimationAnimateAst.prototype.visit=function(visitor,context){return visitor.visitAnimate(this,context)},AnimationAnimateAst}(AnimationAst),AnimationStyleAst=function(_super){function AnimationStyleAst(styles,easing,offset){var _this=_super.call(this)||this;return _this.styles=styles,_this.easing=easing,_this.offset=offset,_this.isEmptyStep=!1,_this}return __extends(AnimationStyleAst,_super),AnimationStyleAst.prototype.visit=function(visitor,context){return visitor.visitStyle(this,context)},AnimationStyleAst}(AnimationAst),AnimationKeyframesSequenceAst=function(_super){function AnimationKeyframesSequenceAst(styles){var _this=_super.call(this)||this;return _this.styles=styles,_this}return __extends(AnimationKeyframesSequenceAst,_super),AnimationKeyframesSequenceAst.prototype.visit=function(visitor,context){return visitor.visitKeyframeSequence(this,context)},AnimationKeyframesSequenceAst}(AnimationAst),AnimationReferenceAst=function(_super){function AnimationReferenceAst(animation,locals){var _this=_super.call(this)||this;return _this.animation=animation,_this.locals=locals,_this}return __extends(AnimationReferenceAst,_super),AnimationReferenceAst.prototype.visit=function(visitor,context){return visitor.visitReference(this,context)},AnimationReferenceAst}(AnimationAst),AnimationAnimateChildAst=function(_super){function AnimationAnimateChildAst(timings,animation,locals){var _this=_super.call(this)||this;return _this.timings=timings,_this.animation=animation,_this.locals=locals,_this}return __extends(AnimationAnimateChildAst,_super),AnimationAnimateChildAst.prototype.visit=function(visitor,context){return visitor.visitAnimateChild(this,context)},AnimationAnimateChildAst}(AnimationAst),AnimationQueryAst=function(_super){function AnimationQueryAst(selector,multi,includeSelf,animation){var _this=_super.call(this)||this;return _this.selector=selector,_this.multi=multi,_this.includeSelf=includeSelf,_this.animation=animation,_this}return __extends(AnimationQueryAst,_super),AnimationQueryAst.prototype.visit=function(visitor,context){return visitor.visitQuery(this,context)},AnimationQueryAst}(AnimationAst),AnimationStaggerAst=function(_super){function AnimationStaggerAst(timings,animation){var _this=_super.call(this)||this;return _this.timings=timings,_this.animation=animation,_this}return __extends(AnimationStaggerAst,_super),AnimationStaggerAst.prototype.visit=function(visitor,context){return visitor.visitStagger(this,context)},AnimationStaggerAst}(AnimationAst),AnimationWaitAst=function(_super){function AnimationWaitAst(delay,animation){var _this=_super.call(this)||this;return _this.delay=delay,_this.animation=animation,_this}return __extends(AnimationWaitAst,_super),AnimationWaitAst.prototype.visit=function(visitor,context){return visitor.visitWait(this,context)},AnimationWaitAst}(AnimationAst),AnimationTimingAst=function(_super){function AnimationTimingAst(duration,delay,easing){var _this=_super.call(this)||this;return _this.duration=duration,_this.delay=delay,_this.easing=easing,_this}return __extends(AnimationTimingAst,_super),AnimationTimingAst.prototype.visit=function(visitor,context){return visitor.visitTiming(this,context)},AnimationTimingAst}(AnimationAst),DynamicAnimationTimingAst=function(_super){function DynamicAnimationTimingAst(value){var _this=_super.call(this,0,0,"")||this;return _this.value=value,_this}return __extends(DynamicAnimationTimingAst,_super),DynamicAnimationTimingAst.prototype.visit=function(visitor,context){return visitor.visitTiming(this,context)},DynamicAnimationTimingAst}(AnimationTimingAst),ANY_STATE="*",LEAVE_TOKEN=":leave",LEAVE_TOKEN_REGEX=new RegExp(LEAVE_TOKEN,"g"),ENTER_TOKEN=":enter",ENTER_TOKEN_REGEX=new RegExp(ENTER_TOKEN,"g"),AnimationAstBuilderVisitor=function(){function AnimationAstBuilderVisitor(){}return AnimationAstBuilderVisitor.prototype.build=function(metadata,errors){var context=new AnimationAstBuilderContext(errors);return visitAnimationNode(this,normalizeAnimationEntry(metadata),context)},AnimationAstBuilderVisitor.prototype.visitTrigger=function(metadata,context){var _this=this,queryCount=context.queryCount=0,depCount=context.depCount=0,states=[],transitions=[];metadata.definitions.forEach(function(def){if(1==def.type){var stateDef_1=def,name=stateDef_1.name;name.split(/\s*,\s*/).forEach(function(n){stateDef_1.name=n,states.push(_this.visitState(stateDef_1,context))}),stateDef_1.name=name}else if(2==def.type){var transition=_this.visitTransition(def,context);queryCount+=transition.queryCount,depCount+=transition.depCount,transitions.push(transition)}else context.errors.push("only state() and transition() definitions can sit inside of a trigger()")});var ast=new AnimationTriggerAst(metadata.name,states,transitions);return ast.queryCount=queryCount,ast.depCount=depCount,ast},AnimationAstBuilderVisitor.prototype.visitState=function(metadata,context){return new AnimationStateAst(metadata.name,this.visitStyle(metadata.styles,context))},AnimationAstBuilderVisitor.prototype.visitTransition=function(metadata,context){context.queryCount=0,context.depCount=0;var entry=visitAnimationNode(this,normalizeAnimationEntry(metadata.animation),context),matchers=parseTransitionExpr(metadata.expr,context.errors),ast=new AnimationTransitionAst(matchers,entry,normalizeLocals(metadata.locals));return ast.queryCount=context.queryCount,ast.depCount=context.depCount,ast},AnimationAstBuilderVisitor.prototype.visitSequence=function(metadata,context){var _this=this;return new AnimationSequenceAst(metadata.steps.map(function(s){return visitAnimationNode(_this,s,context)}))},AnimationAstBuilderVisitor.prototype.visitGroup=function(metadata,context){var _this=this,currentTime=context.currentTime,furthestTime=0,steps=metadata.steps.map(function(step){context.currentTime=currentTime;var ast=visitAnimationNode(_this,step,context);return furthestTime=Math.max(furthestTime,context.currentTime),ast});return context.currentTime=furthestTime,new AnimationGroupAst(steps)},AnimationAstBuilderVisitor.prototype.visitAnimate=function(metadata,context){var timingAst=constructTimingAst(metadata.timings,context.errors);context.currentAnimateTimings=timingAst;var styles=null,styleMetadata=metadata.styles?metadata.styles:_angular_animations.style({});if(6==styleMetadata.type)styles=this.visitKeyframeSequence(styleMetadata,context);else{var styleMetadata_1=metadata.styles,isEmpty=!1;if(!styleMetadata_1){isEmpty=!0;var newStyleData={};timingAst.easing&&(newStyleData.easing=timingAst.easing),styleMetadata_1=_angular_animations.style(newStyleData)}context.currentTime+=timingAst.duration+timingAst.delay;var styleAst=this.visitStyle(styleMetadata_1,context);styleAst.isEmptyStep=isEmpty,styles=styleAst}return context.currentAnimateTimings=null,new AnimationAnimateAst(timingAst,styles)},AnimationAstBuilderVisitor.prototype.visitStyle=function(metadata,context){var ast=this._makeStyleAst(metadata,context);return this._validateStyleAst(ast,context),ast},AnimationAstBuilderVisitor.prototype._makeStyleAst=function(metadata,context){var styles=[];Array.isArray(metadata.styles)?metadata.styles.forEach(function(styleTuple){"string"==typeof styleTuple?styleTuple==_angular_animations.AUTO_STYLE?styles.push(styleTuple):context.errors.push("The provided style string value "+styleTuple+" is not allowed."):styles.push(styleTuple)}):styles.push(metadata.styles);var collectedEasing=null;return styles.forEach(function(styleData){if(isObject(styleData)){var styleMap=styleData,easing=styleMap.easing;easing&&(collectedEasing=easing,delete styleMap.easing)}}),new AnimationStyleAst(styles,collectedEasing,metadata.offset)},AnimationAstBuilderVisitor.prototype._validateStyleAst=function(ast,context){var timings=context.currentAnimateTimings,endTime=context.currentTime,startTime=context.currentTime;timings&&startTime>0&&(startTime-=timings.duration+timings.delay),ast.styles.forEach(function(tuple){"string"!=typeof tuple&&Object.keys(tuple).forEach(function(prop){var collectedStyles=context.collectedStyles[context.currentQuerySelector],collectedEntry=collectedStyles[prop],updateCollectedStyle=!0;collectedEntry&&(startTime!=endTime&&startTime>=collectedEntry.startTime&&endTime<=collectedEntry.endTime&&(context.errors.push('The CSS property "'+prop+'" that exists between the times of "'+collectedEntry.startTime+'ms" and "'+collectedEntry.endTime+'ms" is also being animated in a parallel animation between the times of "'+startTime+'ms" and "'+endTime+'ms"'),updateCollectedStyle=!1),startTime=collectedEntry.startTime),updateCollectedStyle&&(collectedStyles[prop]={startTime:startTime,endTime:endTime}),context.locals&&validateStyleLocals(tuple[prop],context.locals,context.errors)})})},AnimationAstBuilderVisitor.prototype.visitKeyframeSequence=function(metadata,context){var _this=this;if(!context.currentAnimateTimings)return void context.errors.push("keyframes() must be placed inside of a call to animate()");var MAX_KEYFRAME_OFFSET=1,totalKeyframesWithOffsets=0,offsets=[],offsetsOutOfOrder=!1,keyframesOutOfRange=!1,previousOffset=0,keyframes=metadata.steps.map(function(styles){var style$$1=_this._makeStyleAst(styles,context),offsetVal=null!=style$$1.offset?style$$1.offset:consumeOffset(style$$1.styles),offset=0;return null!=offsetVal&&(totalKeyframesWithOffsets++,offset=style$$1.offset=offsetVal),keyframesOutOfRange=keyframesOutOfRange||offset<0||offset>1,offsetsOutOfOrder=offsetsOutOfOrder||offset<previousOffset,previousOffset=offset,offsets.push(offset),style$$1});keyframesOutOfRange&&context.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),offsetsOutOfOrder&&context.errors.push("Please ensure that all keyframe offsets are in order");var length=metadata.steps.length,generatedOffset=0;totalKeyframesWithOffsets>0&&totalKeyframesWithOffsets<length?context.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==totalKeyframesWithOffsets&&(generatedOffset=MAX_KEYFRAME_OFFSET/(length-1));var limit=length-1,currentTime=context.currentTime,animateDuration=context.currentAnimateTimings.duration;return keyframes.forEach(function(kf,i){var offset=generatedOffset>0?i==limit?1:generatedOffset*i:offsets[i],durationUpToThisFrame=offset*animateDuration;context.currentTime=currentTime+context.currentAnimateTimings.delay+durationUpToThisFrame,context.currentAnimateTimings.duration=durationUpToThisFrame,_this._validateStyleAst(kf,context),kf.offset=offset}),new AnimationKeyframesSequenceAst(keyframes)},AnimationAstBuilderVisitor.prototype.visitReference=function(metadata,context){var entry=visitAnimationNode(this,normalizeAnimationEntry(metadata.animation),context);return new AnimationReferenceAst(entry,normalizeLocals(metadata.locals))},AnimationAstBuilderVisitor.prototype.visitAnimateChild=function(metadata,context){var animationArg=null,timings=null,locals=null,args=metadata.args;switch(countArgs(args)){case 0:context.depCount++;break;case 1:var arg=args[0];"string"==typeof arg||arg>=0?(context.depCount++,timings=resolveTimingValue(arg,context.errors)):8==arg.type&&(animationArg=arg);break;case 2:animationArg=args[0],animationArg.type?(animationArg=args[0],locals=normalizeLocals(args[1])):(timings=resolveTimingValue(args[0],context.errors),animationArg=args[1]);break;default:timings=resolveTimingValue(args[0],context.errors),animationArg=args[1],locals=normalizeLocals(args[2])}var animation=animationArg?this.visitReference(animationArg,context):null;return new AnimationAnimateChildAst(timings,animation,locals)},AnimationAstBuilderVisitor.prototype.visitQuery=function(metadata,context){var parentSelector=context.currentQuerySelector;context.queryCount++,context.currentQuery=metadata;var _a=normalizeSelector(metadata.selector),selector=_a[0],includeSelf=_a[1];context.currentQuerySelector=parentSelector.length?parentSelector+" "+selector:selector,getOrSetAsInMap(context.collectedStyles,context.currentQuerySelector,{});var entry=visitAnimationNode(this,normalizeAnimationEntry(metadata.animation),context);return context.currentQuery=null,context.currentQuerySelector=parentSelector,new AnimationQueryAst(selector,metadata.multi,includeSelf,entry)},AnimationAstBuilderVisitor.prototype.visitStagger=function(metadata,context){context.currentQuery&&context.currentQuery.multi||context.errors.push("stagger() can only be used inside of queryAll()");var timings,animation;switch(countArgs(metadata.args)){case 1:timings={duration:0,delay:0,easing:"full"},animation=visitAnimationNode(this,normalizeAnimationEntry(metadata.args[0]),context);break;default:timings=resolveTimingValue(metadata.args[0],context.errors,!0),animation=visitAnimationNode(this,normalizeAnimationEntry(metadata.args[1]),context)}return new AnimationStaggerAst(timings,animation)},AnimationAstBuilderVisitor.prototype.visitWait=function(metadata,context){var timings=resolveTimingValue(metadata.delay,context.errors);timings.duration<0&&context.errors.push("Negative wait delays are not supported"),timings.duration&&timings.delay&&context.errors.push("Wait delays can only support a single timing value"),timings.easing&&context.errors.push("Wait delays cannot support easing values");var animation=metadata.animation?visitAnimationNode(this,normalizeAnimationEntry(metadata.animation),context):null;return new AnimationWaitAst(timings.duration,animation)},AnimationAstBuilderVisitor}(),AnimationAstBuilderContext=function(){function AnimationAstBuilderContext(errors){this.errors=errors,this.queryCount=0,this.depCount=0,this.currentTime=0,this.collectedStyles={},this.locals=null;var ROOT_SELECTOR="";this.currentQuerySelector=ROOT_SELECTOR,this.collectedStyles[ROOT_SELECTOR]={}}return AnimationAstBuilderContext}(),ElementInstructionMap=function(){function ElementInstructionMap(){this._map=new Map}return ElementInstructionMap.prototype.consume=function(element){var instructions=this._map.get(element);return instructions?this._map.delete(element):instructions=[],instructions},ElementInstructionMap.prototype.append=function(element,instructions){var existingInstructions=this._map.get(element);existingInstructions||this._map.set(element,existingInstructions=[]),existingInstructions.push.apply(existingInstructions,instructions)},ElementInstructionMap.prototype.has=function(element){return this._map.has(element)},ElementInstructionMap.prototype.clear=function(){this._map.clear()},ElementInstructionMap}(),DEFAULT_NOOP_PREVIOUS_NODE={},AnimationTimelineContext=function(){function AnimationTimelineContext(element,subInstructions,errors,timelines,initialTimeline){void 0===initialTimeline&&(initialTimeline=null),this.element=element,this.errors=errors,this.timelines=timelines,this.parentContext=null,this.previousNode=DEFAULT_NOOP_PREVIOUS_NODE,this.subContextCount=0,this.locals=null,this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=initialTimeline||new TimelineBuilder(element,0),timelines.push(this.currentTimeline),this.subInstructions=subInstructions||new ElementInstructionMap}return AnimationTimelineContext.prototype.createSubContext=function(element,newTime){void 0===element&&(element=null),void 0===newTime&&(newTime=0);var target=element||this.element,context=new AnimationTimelineContext(target,this.subInstructions,this.errors,this.timelines,this.currentTimeline.fork(target,newTime));return context.previousNode=this.previousNode,context.currentAnimateTimings=this.currentAnimateTimings,context.locals=this.locals?copyObj(this.locals):null,context.currentQueryIndex=this.currentQueryIndex,context.currentQueryTotal=this.currentQueryTotal,context.parentContext=this,this.subContextCount++,context},AnimationTimelineContext.prototype.transformIntoNewTimeline=function(newTime){return void 0===newTime&&(newTime=0),this.previousNode=DEFAULT_NOOP_PREVIOUS_NODE,this.currentTimeline=this.currentTimeline.fork(this.element,newTime),this.timelines.push(this.currentTimeline),this.currentTimeline},AnimationTimelineContext.prototype.appendInstructionToTimeline=function(instruction,timings){var updatedTimings={duration:timings?timings.duration:instruction.duration,delay:this.currentTimeline.currentTime+(timings?timings.delay:0)+instruction.delay,easing:timings?timings.easing:instruction.easing},builder=new SubTimelineBuilder(instruction.element,instruction.keyframes,instruction.preStyleProps,instruction.postStyleProps,updatedTimings,instruction.stretchStartingKeyframe);return this.timelines.push(builder),updatedTimings},AnimationTimelineContext.prototype.incrementTime=function(time){this.currentTimeline.forwardTime(this.currentTimeline.duration+time)},AnimationTimelineContext}(),AnimationTimelineBuilderVisitor=function(){function AnimationTimelineBuilderVisitor(){}return AnimationTimelineBuilderVisitor.prototype.buildKeyframes=function(rootElement,ast,startingStyles,finalStyles,locals,subInstructions,errors){void 0===subInstructions&&(subInstructions=null);var context=new AnimationTimelineContext(rootElement,subInstructions,errors,[]);locals&&0==Object.keys(locals).length&&(locals=null),context.locals=locals,context.currentTimeline.setStyles([startingStyles],null,!1,context.errors,locals),ast.visit(this,context);var timelines=context.timelines.filter(function(timeline){return timeline.containsAnimation()});if(timelines.length&&Object.keys(finalStyles).length){var tl=timelines[timelines.length-1];tl.allowOnlyTimelineStyles()||tl.setStyles([finalStyles],null,!1,context.errors,locals)}return timelines.length?timelines.map(function(timeline){return timeline.buildKeyframes()}):[createTimelineInstruction(rootElement,[],[],[],0,0,"",!1)]},AnimationTimelineBuilderVisitor.prototype.visitTrigger=function(ast,context){},AnimationTimelineBuilderVisitor.prototype.visitState=function(ast,context){},AnimationTimelineBuilderVisitor.prototype.visitTransition=function(ast,context){},AnimationTimelineBuilderVisitor.prototype.visitAnimateChild=function(ast,context){var innerContext=context.createSubContext();if(innerContext.locals=ast.locals?copyObj(ast.locals):context.locals,ast.animation)innerContext.transformIntoNewTimeline(),this.visitReference(ast.animation,innerContext),context.transformIntoNewTimeline(innerContext.currentTimeline.currentTime);else{var elementInstructions=context.subInstructions.consume(context.element);elementInstructions&&this._visitSubInstructions(elementInstructions,ast.timings,context)}context.previousNode=ast},AnimationTimelineBuilderVisitor.prototype._visitSubInstructions=function(instructions,timings,context){if(!timings||0!==timings.duration){var rootElement=context.element,startTime=context.currentTimeline.currentTime,furthestTime=startTime;if(instructions.forEach(function(instruction){var instructionTimings=context.appendInstructionToTimeline(instruction,timings);furthestTime=Math.max(furthestTime,instructionTimings.duration+instructionTimings.delay)}),startTime!=furthestTime){var delay=0,parentTimings={duration:furthestTime-startTime,delay:delay,easing:""},keyframes=[{offset:0},{offset:1}],parentInstruction=createTimelineInstruction(rootElement,keyframes,[],[],parentTimings.duration,delay,"",!0);context.appendInstructionToTimeline(parentInstruction,parentTimings),context.transformIntoNewTimeline(furthestTime)}}},AnimationTimelineBuilderVisitor.prototype.visitReference=function(ast,context){ast.locals&&(context.locals=context.locals||{},Object.keys(ast.locals).forEach(function(varName){context.locals.hasOwnProperty(varName)||(context.locals[varName]=ast.locals[varName])})),ast.animation.visit(this,context),context.previousNode=ast},AnimationTimelineBuilderVisitor.prototype.visitSequence=function(ast,context){var _this=this,subContextCount=context.subContextCount;context.previousNode instanceof AnimationStyleAst&&(context.currentTimeline.forwardFrame(),context.currentTimeline.snapshotCurrentStyles(),context.previousNode=DEFAULT_NOOP_PREVIOUS_NODE),ast.steps.forEach(function(s){return s.visit(_this,context)}),context.subContextCount>subContextCount&&context.transformIntoNewTimeline(),context.previousNode=ast},AnimationTimelineBuilderVisitor.prototype.visitGroup=function(ast,context){var _this=this,innerTimelines=[],furthestTime=context.currentTimeline.currentTime;ast.steps.forEach(function(s){var innerContext=context.createSubContext();s.visit(_this,innerContext),furthestTime=Math.max(furthestTime,innerContext.currentTimeline.currentTime),innerTimelines.push(innerContext.currentTimeline)}),innerTimelines.forEach(function(timeline){return context.currentTimeline.mergeTimelineCollectedStyles(timeline)}),context.transformIntoNewTimeline(furthestTime),context.previousNode=ast},AnimationTimelineBuilderVisitor.prototype.visitTiming=function(ast,context){if(ast instanceof DynamicAnimationTimingAst){var strValue=interpolateStyleLocals(ast.value,context.locals,context.errors);return resolveTimingValue(strValue,context.errors)}return{duration:ast.duration,delay:ast.delay,easing:ast.easing}},AnimationTimelineBuilderVisitor.prototype.visitAnimate=function(ast,context){var timings=context.currentAnimateTimings=this.visitTiming(ast.timings,context);timings.delay&&(context.incrementTime(timings.delay),context.currentTimeline.snapshotCurrentStyles());var style$$1=ast.style;style$$1 instanceof AnimationKeyframesSequenceAst?this.visitKeyframeSequence(style$$1,context):(context.incrementTime(timings.duration),this.visitStyle(style$$1,context)),context.currentAnimateTimings=null,context.previousNode=ast},AnimationTimelineBuilderVisitor.prototype.visitStyle=function(ast,context){!context.currentAnimateTimings&&context.previousNode instanceof AnimationAnimateAst&&context.currentTimeline.forwardFrame();var easing=context.currentAnimateTimings&&context.currentAnimateTimings.easing||ast.easing;this._applyStyles(ast.styles,easing,ast.isEmptyStep,context),context.previousNode=ast},AnimationTimelineBuilderVisitor.prototype._applyStyles=function(styles,easing,treatAsEmptyStep,context){context.currentTimeline.setStyles(styles,easing,treatAsEmptyStep,context.errors,context.locals)},AnimationTimelineBuilderVisitor.prototype.visitKeyframeSequence=function(ast,context){var _this=this,startTime=context.currentTimeline.duration,duration=context.currentAnimateTimings.duration,innerContext=context.createSubContext(),innerTimeline=innerContext.currentTimeline;innerTimeline.easing=context.currentAnimateTimings.easing,ast.styles.forEach(function(step){innerTimeline.forwardTime(step.offset*duration),_this._applyStyles(step.styles,step.easing,!1,innerContext)}),context.currentTimeline.mergeTimelineCollectedStyles(innerTimeline),context.transformIntoNewTimeline(startTime+duration),context.previousNode=ast},AnimationTimelineBuilderVisitor.prototype.visitQuery=function(ast,context){var _this=this,startTime=context.currentTimeline.currentTime;(context.previousNode instanceof AnimationStyleAst||0==startTime&&context.currentTimeline.getCurrentStyleProperties().length)&&(context.currentTimeline.forwardFrame(),context.currentTimeline.snapshotCurrentStyles(),context.previousNode=DEFAULT_NOOP_PREVIOUS_NODE);var furthestTime=startTime,elms=invokeQuery(context.element,ast.selector,ast.multi,ast.includeSelf);context.currentQueryTotal=elms.length;var sameElementTimeline=null;elms.forEach(function(element,i){context.currentQueryIndex=i;var innerContext=context.createSubContext(element),tl=innerContext.currentTimeline;element===context.element&&(sameElementTimeline=tl);var startTime=tl.currentTime;ast.animation.visit(_this,innerContext),tl=innerContext.currentTimeline;var endTime=tl.currentTime;innerContext.previousNode instanceof AnimationStyleAst&&startTime==endTime&&(tl.forwardFrame(),tl.snapshotCurrentStyles(),endTime=tl.currentTime,innerContext.previousNode=DEFAULT_NOOP_PREVIOUS_NODE),furthestTime=Math.max(furthestTime,endTime)}),context.currentQueryIndex=0,context.currentQueryTotal=0,context.transformIntoNewTimeline(furthestTime),sameElementTimeline&&(context.currentTimeline.mergeTimelineCollectedStyles(sameElementTimeline),context.currentTimeline.snapshotCurrentStyles()),context.previousNode=ast},AnimationTimelineBuilderVisitor.prototype.visitStagger=function(ast,context){var parentContext=context.parentContext,tl=context.currentTimeline,timings=ast.timings,duration=Math.abs(timings.duration),maxTime=duration*(context.currentQueryTotal-1),delay=duration*context.currentQueryIndex,staggerTransformer=timings.duration<0?"reverse":timings.easing;switch(staggerTransformer){case"reverse":delay=maxTime-delay;break;case"full":delay=parentContext.currentStaggerTime}delay&&context.currentTimeline.delayNextStep(delay);var startingTime=context.currentTimeline.currentTime;ast.animation.visit(this,context),context.previousNode=ast,parentContext.currentStaggerTime=tl.currentTime-startingTime+(tl.startTime-parentContext.currentTimeline.startTime)},AnimationTimelineBuilderVisitor.prototype.visitWait=function(ast,context){ast.delay&&(context.previousNode instanceof AnimationStyleAst&&(context.currentTimeline.forwardFrame(),context.currentTimeline.snapshotCurrentStyles(),context.previousNode=DEFAULT_NOOP_PREVIOUS_NODE),context.currentTimeline.delayNextStep(ast.delay),context.currentTimeline.snapshotCurrentStyles()),ast.animation&&ast.animation.visit(this,context),context.previousNode=ast},AnimationTimelineBuilderVisitor}(),TimelineBuilder=function(){function TimelineBuilder(element,startTime,_elementTimelineStylesLookup){this.element=element,this.startTime=startTime,this._elementTimelineStylesLookup=_elementTimelineStylesLookup,this.duration=0,this.easing="",this._previousKeyframe={},this._keyframes=new Map,this._styleSummary={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(element),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(element,this._localTimelineStyles)),this._loadKeyframe()}return TimelineBuilder.prototype.containsAnimation=function(){return this._keyframes.size>1},TimelineBuilder.prototype.getCurrentStyleProperties=function(){return Object.keys(this._currentKeyframe)},Object.defineProperty(TimelineBuilder.prototype,"currentTime",{get:function(){return this.startTime+this.duration},enumerable:!0,configurable:!0}),TimelineBuilder.prototype.delayNextStep=function(delay){0==this.duration?this.startTime+=delay:this.forwardTime(this.currentTime+delay)},TimelineBuilder.prototype.warpTiming=function(duration){this.duration=duration},TimelineBuilder.prototype.fork=function(element,currentTime){return void 0===currentTime&&(currentTime=0),new TimelineBuilder(element,currentTime||this.currentTime,this._elementTimelineStylesLookup)},TimelineBuilder.prototype._loadKeyframe=function(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))},TimelineBuilder.prototype.forwardFrame=function(){this.duration++,this._loadKeyframe()},TimelineBuilder.prototype.forwardTime=function(time){this.duration=time,this._loadKeyframe()},TimelineBuilder.prototype._updateStyle=function(prop,value){"easing"!=prop&&(this._localTimelineStyles[prop]=value,this._globalTimelineStyles[prop]=value,this._styleSummary[prop]={time:this.currentTime,value:value})},TimelineBuilder.prototype.allowOnlyTimelineStyles=function(){return this._currentEmptyStepKeyframe!==this._currentKeyframe},TimelineBuilder.prototype.setStyles=function(input,easing,treatAsEmptyStep,errors,locals){var _this=this;if(void 0===locals&&(locals=null),easing&&(this._previousKeyframe.easing=easing),treatAsEmptyStep)Object.keys(this._globalTimelineStyles).forEach(function(prop){_this._backFill[prop]=_this._globalTimelineStyles[prop]||_angular_animations.AUTO_STYLE,_this._currentKeyframe[prop]=_angular_animations.AUTO_STYLE}),this._currentEmptyStepKeyframe=this._currentKeyframe;else{var styles_1=flattenStyles(input,this._globalTimelineStyles);Object.keys(styles_1).forEach(function(prop){var val=styles_1[prop];locals&&(val=interpolateStyleLocals(val,locals,errors)),_this._currentKeyframe[prop]=val,_this._localTimelineStyles[prop]||(_this._backFill[prop]=_this._globalTimelineStyles.hasOwnProperty(prop)?_this._globalTimelineStyles[prop]:_angular_animations.AUTO_STYLE),_this._updateStyle(prop,val)}),Object.keys(this._localTimelineStyles).forEach(function(prop){_this._currentKeyframe.hasOwnProperty(prop)||(_this._currentKeyframe[prop]=_this._localTimelineStyles[prop])})}},TimelineBuilder.prototype.snapshotCurrentStyles=function(){copyStyles(this._localTimelineStyles,!1,this._currentKeyframe);
},TimelineBuilder.prototype.getFinalKeyframe=function(){return this._keyframes.get(this.duration)},Object.defineProperty(TimelineBuilder.prototype,"properties",{get:function(){var properties=[];for(var prop in this._currentKeyframe)properties.push(prop);return properties},enumerable:!0,configurable:!0}),TimelineBuilder.prototype.mergeTimelineCollectedStyles=function(timeline){var _this=this;Object.keys(timeline._styleSummary).forEach(function(prop){var details0=_this._styleSummary[prop],details1=timeline._styleSummary[prop];(!details0||details1.time>details0.time)&&_this._updateStyle(prop,details1.value)})},TimelineBuilder.prototype.buildKeyframes=function(){var _this=this,preStyleProps=new Set,postStyleProps=new Set,finalKeyframes=[];this._keyframes.forEach(function(keyframe,time){var finalKeyframe=copyStyles(keyframe,!0);Object.keys(finalKeyframe).forEach(function(prop){var value=finalKeyframe[prop];value==_angular_animations.PRE_STYLE?preStyleProps.add(prop):value==_angular_animations.AUTO_STYLE&&postStyleProps.add(prop)}),finalKeyframe.offset=time/_this.duration,finalKeyframes.push(finalKeyframe)});var preProps=preStyleProps.size?iteratorToArray(preStyleProps.values()):[],postProps=postStyleProps.size?iteratorToArray(postStyleProps.values()):[];return createTimelineInstruction(this.element,finalKeyframes,preProps,postProps,this.duration,this.startTime,this.easing,!1)},TimelineBuilder}(),SubTimelineBuilder=function(_super){function SubTimelineBuilder(element,keyframes,preStyleProps,postStyleProps,timings,_stretchStartingKeyframe){void 0===_stretchStartingKeyframe&&(_stretchStartingKeyframe=!1);var _this=_super.call(this,element,timings.delay)||this;return _this.element=element,_this.keyframes=keyframes,_this.preStyleProps=preStyleProps,_this.postStyleProps=postStyleProps,_this._stretchStartingKeyframe=_stretchStartingKeyframe,_this.timings={duration:timings.duration,delay:timings.delay,easing:timings.easing},_this}return __extends(SubTimelineBuilder,_super),SubTimelineBuilder.prototype.containsAnimation=function(){return this.keyframes.length>1},SubTimelineBuilder.prototype.buildKeyframes=function(){var keyframes=this.keyframes,_a=this.timings,delay=_a.delay,duration=_a.duration,easing=_a.easing;if(this._stretchStartingKeyframe&&delay){var newKeyframes=[],totalTime=duration+delay,startingGap=delay/totalTime,newFirstKeyframe=copyStyles(keyframes[0],!1);newFirstKeyframe.offset=0,newKeyframes.push(newFirstKeyframe);var oldFirstKeyframe=copyStyles(keyframes[0],!1);oldFirstKeyframe.offset=roundOffset(startingGap),newKeyframes.push(oldFirstKeyframe);for(var limit=keyframes.length-1,i=1;i<=limit;i++){var kf=copyStyles(keyframes[i],!1),oldOffset=kf.offset,timeAtKeyframe=delay+oldOffset*duration;kf.offset=roundOffset(timeAtKeyframe/totalTime),newKeyframes.push(kf)}duration=totalTime,delay=0,easing="",keyframes=newKeyframes}return createTimelineInstruction(this.element,keyframes,this.preStyleProps,this.postStyleProps,duration,delay,easing,!0)},SubTimelineBuilder}(TimelineBuilder),Animation=function(){function Animation(input){var errors=[],ast=buildAnimationAst(input,errors);if(errors.length){var errorMessage="animation validation failed:\n"+errors.join("\n");throw new Error(errorMessage)}this._animationAst=ast}return Animation.prototype.buildTimelines=function(element,startingStyles,destinationStyles,locals,subInstructions){void 0===subInstructions&&(subInstructions=null);var start=Array.isArray(startingStyles)?normalizeStyles(startingStyles):startingStyles,dest=Array.isArray(destinationStyles)?normalizeStyles(destinationStyles):destinationStyles,errors=[];subInstructions=subInstructions||new ElementInstructionMap;var result=buildAnimationTimelines(element,this._animationAst,start,dest,locals,subInstructions,errors);if(errors.length){var errorMessage="animation building failed:\n"+errors.join("\n");throw new Error(errorMessage)}return result},Animation}(),AnimationStyleNormalizer=function(){function AnimationStyleNormalizer(){}return AnimationStyleNormalizer.prototype.normalizePropertyName=function(propertyName,errors){},AnimationStyleNormalizer.prototype.normalizeStyleValue=function(userProvidedProperty,normalizedProperty,value,errors){},AnimationStyleNormalizer}(),NoopAnimationStyleNormalizer=function(){function NoopAnimationStyleNormalizer(){}return NoopAnimationStyleNormalizer.prototype.normalizePropertyName=function(propertyName,errors){return propertyName},NoopAnimationStyleNormalizer.prototype.normalizeStyleValue=function(userProvidedProperty,normalizedProperty,value,errors){return value},NoopAnimationStyleNormalizer}(),WebAnimationsStyleNormalizer=function(_super){function WebAnimationsStyleNormalizer(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(WebAnimationsStyleNormalizer,_super),WebAnimationsStyleNormalizer.prototype.normalizePropertyName=function(propertyName,errors){return dashCaseToCamelCase(propertyName)},WebAnimationsStyleNormalizer.prototype.normalizeStyleValue=function(userProvidedProperty,normalizedProperty,value,errors){var unit="",strVal=value.toString().trim();if(DIMENSIONAL_PROP_MAP[normalizedProperty]&&0!==value&&"0"!==value)if("number"==typeof value)unit="px";else{var valAndSuffixMatch=value.match(/^[+-]?[\d\.]+([a-z]*)$/);valAndSuffixMatch&&0==valAndSuffixMatch[1].length&&errors.push("Please provide a CSS unit value for "+userProvidedProperty+":"+value)}return strVal+unit},WebAnimationsStyleNormalizer}(AnimationStyleNormalizer),DIMENSIONAL_PROP_MAP=makeBooleanMap("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent".split(",")),DASH_CASE_REGEXP=/-+([a-z0-9])/g,AnimationTransitionFactory=function(){function AnimationTransitionFactory(_triggerName,ast,_stateStyles){this._triggerName=_triggerName,this.ast=ast,this._stateStyles=_stateStyles}return AnimationTransitionFactory.prototype.match=function(currentState,nextState){return oneOrMoreTransitionsMatch(this.ast.matchers,currentState,nextState)},AnimationTransitionFactory.prototype.build=function(element,currentState,nextState,locals,subInstructions){var _this=this;void 0===locals&&(locals=null),void 0===subInstructions&&(subInstructions=null);var animationLocals=null;this.ast.locals&&(animationLocals=locals||{},Object.keys(this.ast.locals).forEach(function(prop){animationLocals.hasOwnProperty(prop)||(animationLocals[prop]=_this.ast.locals[prop])}));var backupStateStyles=this._stateStyles["*"]||{},currentStateStyles=this._stateStyles[currentState]||backupStateStyles,nextStateStyles=this._stateStyles[nextState]||backupStateStyles,errors=[],timelines=buildAnimationTimelines(element,this.ast.animation,currentStateStyles,nextStateStyles,animationLocals,subInstructions,errors);if(errors.length){var errorMessage="animation building failed:\n"+errors.join("\n");throw new Error(errorMessage)}var preStyleMap=new Map,postStyleMap=new Map,queriedElements=new Set;timelines.forEach(function(tl){var elm=tl.element,preProps=getOrSetAsInMap(preStyleMap,elm,{});tl.preStyleProps.forEach(function(prop){return preProps[prop]=!0});var postProps=getOrSetAsInMap(postStyleMap,elm,{});tl.postStyleProps.forEach(function(prop){return postProps[prop]=!0}),elm!==element&&queriedElements.add(elm)});var queriedElementsList=iteratorToArray(queriedElements.values());return createTransitionInstruction(element,this._triggerName,currentState,nextState,"void"===nextState,currentStateStyles,nextStateStyles,timelines,queriedElementsList,preStyleMap,postStyleMap)},AnimationTransitionFactory}(),AnimationTrigger=function(){function AnimationTrigger(name,ast){var _this=this;this.name=name,this.ast=ast,this.transitionFactories=[],this.states={},ast.states.forEach(function(ast){var obj=_this.states[ast.name]={};ast.style.styles.forEach(function(styleTuple){"object"==typeof styleTuple&&copyStyles(styleTuple,!1,obj)})}),ast.transitions.forEach(function(ast){_this.transitionFactories.push(new AnimationTransitionFactory(name,ast,_this.states))}),this.fallbackTransition=createFallbackTransition(name,this.states)}return Object.defineProperty(AnimationTrigger.prototype,"containsQueries",{get:function(){return this.ast.queryCount>0},enumerable:!0,configurable:!0}),AnimationTrigger.prototype.matchTransition=function(currentState,nextState){return this.transitionFactories.find(function(f){return f.match(currentState,nextState)})},AnimationTrigger}(),EMPTY_INSTRUCTION_MAP=new ElementInstructionMap,TimelineAnimationEngine=function(){function TimelineAnimationEngine(_driver,_normalizer){this._driver=_driver,this._normalizer=_normalizer,this._animations={},this._playersById={},this.players=[]}return TimelineAnimationEngine.prototype.register=function(id,metadata){var errors=[],ast=buildAnimationAst(metadata,errors);if(errors.length)throw new Error("Unable to build the animation due to the following errors: "+errors.join("\n"));this._animations[id]=ast},TimelineAnimationEngine.prototype._buildPlayer=function(i,preStyles,postStyles){var element=i.element,keyframes=normalizeKeyframes(this._driver,this._normalizer,element,i.keyframes,preStyles,postStyles);return this._driver.animate(element,keyframes,i.duration,i.delay,i.easing,[])},TimelineAnimationEngine.prototype.create=function(id,element,locals){var _this=this;void 0===locals&&(locals={});var instructions,errors=[],ast=this._animations[id],autoStylesMap=new Map;if(ast?(instructions=buildAnimationTimelines(element,ast,{},{},locals,EMPTY_INSTRUCTION_MAP,errors),instructions.forEach(function(inst){var styles=getOrSetAsInMap(autoStylesMap,inst.element,{});inst.postStyleProps.forEach(function(prop){return styles[prop]=null})})):errors.push("The requested animation doesn't exist or has already been destroyed"),errors.length)throw new Error("Unable to create the animation due to the following errors: "+errors.join("\n"));autoStylesMap.forEach(function(styles,element){Object.keys(styles).forEach(function(prop){styles[prop]=_this._driver.computeStyle(element,prop,_angular_animations.AUTO_STYLE)})});var players=instructions.map(function(i){var styles=autoStylesMap.get(i.element);return _this._buildPlayer(i,{},styles)}),player=optimizeGroupPlayer(players);return this._playersById[id]=player,player.onDestroy(function(){return _this.destroy(id)}),this.players.push(player),player},TimelineAnimationEngine.prototype.destroy=function(id){var player=this._getPlayer(id);player.destroy(),delete this._playersById[id];var index=this.players.indexOf(player);index>=0&&this.players.splice(index,1)},TimelineAnimationEngine.prototype._getPlayer=function(id){var player=this._playersById[id];if(!player)throw new Error("Unable to find the timeline player referenced by "+id);return player},TimelineAnimationEngine.prototype.listen=function(id,element,eventName,callback){var baseEvent=makeAnimationEvent(element,null,null,null);return listenOnPlayer(this._getPlayer(id),eventName,baseEvent,callback),function(){}},TimelineAnimationEngine.prototype.command=function(id,element,command,args){if("register"==command)return void this.register(id,args[0]);if("create"==command){var locals=args[0]||{};return void this.create(id,element,locals)}var player=this._getPlayer(id);switch(command){case"play":player.play();break;case"pause":player.pause();break;case"reset":player.reset();break;case"restart":player.restart();break;case"finish":player.finish();break;case"init":player.init();break;case"setPosition":player.setPosition(parseFloat(args[0]));break;case"destroy":this.destroy(id)}},TimelineAnimationEngine}(),EMPTY_PLAYER_ARRAY=[],StateValue=function(){function StateValue(input){var isObj=input&&input.hasOwnProperty("value"),value=isObj?input.value:input;this.value=normalizeTriggerValue(value),this.data=isObj?input:{value:value}}return StateValue.prototype.absorbValues=function(values){var _this=this;Object.keys(values).forEach(function(prop){null==_this.data[prop]&&(_this.data[prop]=values[prop])})},StateValue}(),VOID_VALUE="void",DEFAULT_STATE_VALUE=new StateValue(VOID_VALUE),DELETED_STATE_VALUE=new StateValue("DELETED"),POTENTIAL_ENTER_CLASSNAME=ENTER_CLASSNAME+"-temp",POTENTIAL_ENTER_SELECTOR="."+POTENTIAL_ENTER_CLASSNAME,AnimationTransitionNamespace=function(){function AnimationTransitionNamespace(id,hostElement,_engine){this.id=id,this.hostElement=hostElement,this._engine=_engine,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+id}return AnimationTransitionNamespace.prototype.listen=function(element,name,phase,callback){var _this=this;if(!this._triggers.hasOwnProperty(name))throw new Error('Unable to listen on the animation trigger event "'+phase+'" because the animation trigger "'+name+"\" doesn't exist!");if(null==phase||0==phase.length)throw new Error('Unable to listen on the animation trigger "'+name+'" because the provided event is undefined!');if(!isTriggerEventValid(phase))throw new Error('The provided animation trigger event "'+phase+'" for the animation trigger "'+name+'" is not supported!');var listeners=getOrSetAsInMap(this._elementListeners,element,[]),data={name:name,phase:phase,callback:callback};listeners.push(data);var triggersWithStates=getOrSetAsInMap(this._engine.statesByElement,element,{});return triggersWithStates.hasOwnProperty(name)||(element.classList.add(NG_TRIGGER_CLASSNAME),element.classList.add(NG_TRIGGER_CLASSNAME+"-"+name),triggersWithStates[name]=null),function(){_this._engine.afterFlush(function(){var index=listeners.indexOf(data);index>=0&&listeners.splice(index,1),_this._triggers[name]||delete triggersWithStates[name]})}},AnimationTransitionNamespace.prototype.register=function(name,ast){return!this._triggers[name]&&(this._triggers[name]=ast,!0)},AnimationTransitionNamespace.prototype._getTrigger=function(name){var trigger=this._triggers[name];if(!trigger)throw new Error('The provided animation trigger "'+name+'" has not been registered!');return trigger},AnimationTransitionNamespace.prototype.trigger=function(element,triggerName,value,defaultToFallback){var _this=this;void 0===defaultToFallback&&(defaultToFallback=!0);var trigger=this._getTrigger(triggerName),player=new TransitionAnimationPlayer(this.id,triggerName,element);if(!document.body.contains(element))return player;var triggersWithStates=this._engine.statesByElement.get(element);triggersWithStates||(element.classList.add(NG_TRIGGER_CLASSNAME),element.classList.add(NG_TRIGGER_CLASSNAME+"-"+triggerName),this._engine.statesByElement.set(element,triggersWithStates={}));var fromState=triggersWithStates[triggerName],toState=new StateValue(value),isObj=value&&value.hasOwnProperty("value");if(!isObj&&fromState&&toState.absorbValues(fromState.data),triggersWithStates[triggerName]=toState,fromState){if(fromState===DELETED_STATE_VALUE)return player}else fromState=DEFAULT_STATE_VALUE;var playersOnElement=getOrSetAsInMap(this._engine.playersByElement,element,[]);playersOnElement.forEach(function(player){player.namespaceId==_this.id&&player.triggerName==triggerName&&player.queued&&player.destroy()});var transition=trigger.matchTransition(fromState.value,toState.value),isFallbackTransition=!1;if(!transition){if(!defaultToFallback)return null;transition=trigger.fallbackTransition,isFallbackTransition=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:element,triggerName:triggerName,transition:transition,fromState:fromState,toState:toState,player:player,isFallbackTransition:isFallbackTransition}),isFallbackTransition||element.classList.add(NG_ANIMATING_CLASSNAME),player.onDone(function(){element.classList.remove(NG_ANIMATING_CLASSNAME);var index=_this.players.indexOf(player);index>=0&&_this.players.splice(index,1);var players=_this._engine.playersByElement.get(element);if(players){var index_1=players.indexOf(player);index_1>=0&&players.splice(index_1,1)}}),this.players.push(player),playersOnElement.push(player),player},AnimationTransitionNamespace.prototype.deregister=function(name){var _this=this;delete this._triggers[name],this._engine.statesByElement.forEach(function(stateMap,element){delete stateMap[name]}),this._elementListeners.forEach(function(listeners,element){_this._elementListeners.set(element,listeners.filter(function(entry){return entry.name!=name}))})},AnimationTransitionNamespace.prototype._onElementDestroy=function(element){this._engine.statesByElement.delete(element),this._elementListeners.delete(element);var elementPlayers=this._engine.playersByElement.get(element);elementPlayers&&(elementPlayers.forEach(function(player){return player.destroy()}),this._engine.playersByElement.delete(element))},AnimationTransitionNamespace.prototype._destroyInnerNodes=function(rootElement,context,animate){var _this=this;void 0===animate&&(animate=!1),listToArray(rootElement.querySelectorAll(NG_TRIGGER_SELECTOR)).forEach(function(elm){if(animate&&elm.classList.contains(_this._hostClassName)){var innerNs=_this._engine.namespacesByHostElement.get(elm);innerNs&&innerNs.removeNode(elm,context,!0),_this.removeNode(elm,context,!0)}else _this._onElementDestroy(elm)})},AnimationTransitionNamespace.prototype.removeNode=function(element,context,doNotRecurse){var _this=this,engine=this._engine;element.classList.add(LEAVE_CLASSNAME),engine.afterFlush(function(){return element.classList.remove(LEAVE_CLASSNAME)}),!doNotRecurse&&element.childElementCount&&this._destroyInnerNodes(element,context,!0);var triggerStates=engine.statesByElement.get(element);if(triggerStates){var players_1=[];if(Object.keys(triggerStates).forEach(function(triggerName){if(_this._triggers[triggerName]){var player=_this.trigger(element,triggerName,VOID_VALUE,!1);player&&players_1.push(player)}}),players_1.length)return void optimizeGroupPlayer(players_1).onDone(function(){engine.destroyInnerAnimations(element),_this._onElementDestroy(element),engine.onRemovalComplete(element,context)})}var containsPotentialParentTransition=!1;if(engine.totalAnimations){var currentPlayers=engine.players.length?engine.playersByQueriedElement.get(element):[];if(currentPlayers&&currentPlayers.length)containsPotentialParentTransition=!0;else for(var parent=element;parent=parent.parentNode;){var triggers=engine.statesByElement.get(parent);if(triggers){containsPotentialParentTransition=!0;break}}}var listeners=this._elementListeners.get(element);if(listeners){var visitedTriggers_1=new Set;listeners.forEach(function(listener){var triggerName=listener.name;if(!visitedTriggers_1.has(triggerName)){visitedTriggers_1.add(triggerName);var trigger=_this._triggers[triggerName],transition=trigger.fallbackTransition,fromState=engine.statesByElement.get(element)[triggerName]||DEFAULT_STATE_VALUE,toState=new StateValue(VOID_VALUE),player=new TransitionAnimationPlayer(_this.id,triggerName,element);_this._engine.totalQueuedPlayers++,_this._queue.push({element:element,triggerName:triggerName,transition:transition,fromState:fromState,toState:toState,player:player,isFallbackTransition:!0})}})}containsPotentialParentTransition?engine.queuedRemovals.set(element,function(){engine.destroyInnerAnimations(element),_this._onElementDestroy(element),engine.onRemovalComplete(element,context)}):(engine.afterFlush(function(){return _this._onElementDestroy(element)}),engine.destroyInnerAnimations(element),engine.onRemovalComplete(element,context))},AnimationTransitionNamespace.prototype.insertNode=function(element,parent){element.classList.add(this._hostClassName)},AnimationTransitionNamespace.prototype.drainQueuedTransitions=function(){var _this=this,instructions=[];return this._queue.forEach(function(entry){var player=entry.player;if(!player.destroyed){var element=entry.element,listeners=_this._elementListeners.get(element);listeners&&listeners.forEach(function(listener){if(listener.name==entry.triggerName){var baseEvent=makeAnimationEvent(element,entry.triggerName,entry.fromState.value,entry.toState.value);listenOnPlayer(entry.player,listener.phase,baseEvent,listener.callback)}}),player.markedForDestroy?_this._engine.afterFlush(function(){player.destroy()}):instructions.push(entry)}}),this._queue=[],instructions.sort(function(a,b){var d0=a.transition.ast.depCount,d1=b.transition.ast.depCount;return 0==d0||0==d1?d0-d1:a.element.contains(b.element)?1:-1})},AnimationTransitionNamespace.prototype.destroy=function(context){this.players.forEach(function(p){return p.destroy()}),this._destroyInnerNodes(this.hostElement,context)},AnimationTransitionNamespace.prototype.elementContainsData=function(element){var containsData=!1;return this._elementListeners.has(element)&&(containsData=!0),containsData=!!this._queue.find(function(entry){return entry.element===element})||containsData},AnimationTransitionNamespace}(),TransitionAnimationEngine=function(){function TransitionAnimationEngine(_driver,_normalizer){this._driver=_driver,this._normalizer=_normalizer,this.players=[],this.queuedRemovals=new Map,this.newlyInserted=new Set,this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.onRemovalComplete=function(element,context){}}return Object.defineProperty(TransitionAnimationEngine.prototype,"queuedPlayers",{get:function(){var players=[];return this._namespaceList.forEach(function(ns){ns.players.forEach(function(player){player.queued&&players.push(player)})}),players},enumerable:!0,configurable:!0}),TransitionAnimationEngine.prototype.createNamespace=function(namespaceId,hostElement){var ns=new AnimationTransitionNamespace(namespaceId,hostElement,this);return hostElement.parentNode?this._balanceNamespaceList(ns,hostElement):this.newHostElements.set(hostElement,ns),this._namespaceLookup[namespaceId]=ns},TransitionAnimationEngine.prototype._balanceNamespaceList=function(ns,hostElement){var limit=this._namespaceList.length-1;if(limit>=0){for(var found=!1,i=limit;i>=0;i--){var nextNamespace=this._namespaceList[i];if(nextNamespace.hostElement.contains(hostElement)){this._namespaceList.splice(i+1,0,ns),found=!0;break}}found||this._namespaceList.splice(0,0,ns)}else this._namespaceList.push(ns);return this.namespacesByHostElement.set(hostElement,ns),ns},TransitionAnimationEngine.prototype.register=function(namespaceId,hostElement,name,trigger){var ns=this._namespaceLookup[namespaceId];ns||(ns=this.createNamespace(namespaceId,hostElement)),ns.register(name,trigger)&&this.totalAnimations++},TransitionAnimationEngine.prototype.destroy=function(namespaceId,context){var _this=this,ns=this._fetchNamespace(namespaceId);this.afterFlush(function(){_this.namespacesByHostElement.delete(ns.hostElement),delete _this._namespaceLookup[namespaceId];var index=_this._namespaceList.indexOf(ns);index>=0&&_this._namespaceList.splice(index,1)}),this.afterFlushAnimationsDone(function(){return ns.destroy(context)})},TransitionAnimationEngine.prototype._fetchNamespace=function(id){var ns=this._namespaceLookup[id];return ns},TransitionAnimationEngine.prototype.trigger=function(namespaceId,element,name,value){return!!isElementNode(element)&&(this._fetchNamespace(namespaceId).trigger(element,name,value),!0)},TransitionAnimationEngine.prototype.insertNode=function(namespaceId,element,parent,insertBefore){isElementNode(element)&&(this._fetchNamespace(namespaceId).insertNode(element,parent),insertBefore&&this.newlyInserted.add(element))},TransitionAnimationEngine.prototype.removeNode=function(namespaceId,element,context,doNotRecurse){return isElementNode(element)?void this._fetchNamespace(namespaceId).removeNode(element,context,doNotRecurse):void this.onRemovalComplete(element,context)},TransitionAnimationEngine.prototype.listen=function(namespaceId,element,name,phase,callback){return isElementNode(element)?this._fetchNamespace(namespaceId).listen(element,name,phase,callback):function(){}},TransitionAnimationEngine.prototype._buildInstruction=function(entry,subTimelines){return entry.transition.build(entry.element,entry.fromState.value,entry.toState.value,entry.toState.data,subTimelines)},TransitionAnimationEngine.prototype.destroyInnerAnimations=function(containerElement){var _this=this;listToArray(containerElement.querySelectorAll(NG_TRIGGER_SELECTOR)).forEach(function(element){var players=_this.playersByElement.get(element);players&&players.forEach(function(player){player.queued?player.markedForDestroy=!0:player.destroy()});var stateMap=_this.statesByElement.get(element);stateMap&&Object.keys(stateMap).forEach(function(triggerName){return stateMap[triggerName]=DELETED_STATE_VALUE})})},TransitionAnimationEngine.prototype.flush=function(){var _this=this,players=[];if(this.newHostElements.size&&(this.newHostElements.forEach(function(ns,element){_this._balanceNamespaceList(ns,element)}),this.newHostElements.clear()),this._namespaceList.length&&(this.totalQueuedPlayers||this.queuedRemovals.size)&&(players=this._flushAnimations()),this.totalQueuedPlayers=0,this.queuedRemovals.clear(),this.newlyInserted.clear(),this._flushFns.forEach(function(fn){return fn()}),this._flushFns=[],this._whenQuietFns.length){var quietFns_1=this._whenQuietFns;this._whenQuietFns=[],players.length?optimizeGroupPlayer(players).onDone(function(){quietFns_1.forEach(function(fn){return fn()})}):quietFns_1.forEach(function(fn){return fn()})}},TransitionAnimationEngine.prototype._populateEnterElements=function(){var allEnterNodes=iteratorToArray(this.newlyInserted.values());allEnterNodes.forEach(function(element){return element.classList.add(POTENTIAL_ENTER_CLASSNAME)});var enterNodes=filterNodeClasses(document.body,POTENTIAL_ENTER_SELECTOR);return enterNodes.forEach(function(element){return element.classList.add(ENTER_CLASSNAME)}),allEnterNodes.forEach(function(element){return element.classList.remove(POTENTIAL_ENTER_CLASSNAME)}),enterNodes},TransitionAnimationEngine.prototype._flushAnimations=function(){for(var _this=this,subTimelines=new ElementInstructionMap,skippedPlayers=[],skippedPlayersMap=new Map,queuedInstructions=[],queriedElements=new Map,allPreStyleElements=new Map,allPostStyleElements=new Map,enterNodes=this._populateEnterElements(),i=this._namespaceList.length-1;i>=0;i--){var ns=this._namespaceList[i];ns.drainQueuedTransitions().forEach(function(entry){var instruction=_this._buildInstruction(entry,subTimelines),player=entry.player,element=entry.element;if(entry.isFallbackTransition&&!instruction.isRemovalTransition)return void skippedPlayers.push(player);instruction.timelines.forEach(function(tl){return tl.stretchStartingKeyframe=!0}),subTimelines.append(element,instruction.timelines);var tuple={instruction:instruction,player:player,element:element};queuedInstructions.push(tuple),instruction.queriedElements.forEach(function(element){return getOrSetAsInMap(queriedElements,element,[]).push(player)}),instruction.preStyleProps.forEach(function(stringMap,element){var props=Object.keys(stringMap);if(props.length){var setVal_1=allPreStyleElements.get(element);setVal_1||allPreStyleElements.set(element,setVal_1=new Set),props.forEach(function(prop){return setVal_1.add(prop)})}}),instruction.postStyleProps.forEach(function(stringMap,element){var props=Object.keys(stringMap),setVal=allPostStyleElements.get(element);setVal||allPostStyleElements.set(element,setVal=new Set),props.forEach(function(prop){return setVal.add(prop)})})})}var allPreviousPlayersMap=new Map,sortedParentElements=[];queuedInstructions.forEach(function(entry){var element=entry.element;subTimelines.has(element)&&(sortedParentElements.unshift(element),_this._beforeAnimationBuild(entry.player.namespaceId,entry.instruction,allPreviousPlayersMap))}),allPreviousPlayersMap.forEach(function(players){players.forEach(function(player){return player.destroy()})});var leaveNodes=allPostStyleElements.size?listToArray(document.body.querySelectorAll(LEAVE_SELECTOR)):[],preStylesMap=allPreStyleElements.size?cloakAndComputeStyles(this._driver,enterNodes,allPreStyleElements,_angular_animations.PRE_STYLE):new Map,postStylesMap=cloakAndComputeStyles(this._driver,leaveNodes,allPostStyleElements,_angular_animations.AUTO_STYLE),rootPlayers=[],subPlayers=[];return queuedInstructions.forEach(function(entry){var element=entry.element,player=entry.player,instruction=entry.instruction;if(subTimelines.has(element)){var innerPlayer=_this._buildAnimation(player.namespaceId,instruction,allPreviousPlayersMap,skippedPlayersMap,preStylesMap,postStylesMap);player.setRealPlayer(innerPlayer);for(var parentHasPriority=null,i=0;i<sortedParentElements.length;i++){var parent=sortedParentElements[i];if(parent===element)break;if(parent.contains(element)){parentHasPriority=parent;break}}if(parentHasPriority){var parentPlayers=_this.playersByElement.get(parentHasPriority);parentPlayers&&parentPlayers.length&&(player.parentPlayer=optimizeGroupPlayer(parentPlayers)),skippedPlayers.push(player)}else rootPlayers.push(player)}else eraseStyles(element,instruction.fromStyles),player.onDestroy(function(){return setStyles(element,instruction.toStyles)}),subPlayers.push(player)}),subPlayers.forEach(function(player){var playersForElement=skippedPlayersMap.get(player.element);if(playersForElement&&playersForElement.length){var innerPlayer=optimizeGroupPlayer(playersForElement);player.setRealPlayer(innerPlayer)}}),rootPlayers.forEach(function(player){_this.players.push(player),player.onDone(function(){player.destroy();var index=_this.players.indexOf(player);_this.players.splice(index,1)}),player.play()}),skippedPlayers.forEach(function(player){player.parentPlayer?player.parentPlayer.onDestroy(function(){return player.destroy()}):player.destroy()}),this.queuedRemovals.forEach(function(fn,element){var players=queriedElements.get(element);if(players)optimizeGroupPlayer(players).onDone(fn);else{for(var elementPlayers=null,parent=element;parent=parent.parentNode;){var playersForThisElement=_this.playersByElement.get(parent);if(playersForThisElement&&playersForThisElement.length){elementPlayers=playersForThisElement;break}}elementPlayers?optimizeGroupPlayer(elementPlayers).onDone(fn):fn()}}),enterNodes.forEach(function(element){return element.classList.remove(ENTER_CLASSNAME)}),rootPlayers},TransitionAnimationEngine.prototype.elementContainsData=function(namespaceId,element){var containsData=!1;return this.queuedRemovals.has(element)&&(containsData=!0),this.newlyInserted.has(element)&&(containsData=!0),this.playersByElement.has(element)&&(containsData=!0),this.playersByQueriedElement.has(element)&&(containsData=!0),this.statesByElement.has(element)&&(containsData=!0),this._fetchNamespace(namespaceId).elementContainsData(element)||containsData},TransitionAnimationEngine.prototype.afterFlush=function(callback){this._flushFns.push(callback)},TransitionAnimationEngine.prototype.afterFlushAnimationsDone=function(callback){this._whenQuietFns.push(callback)},TransitionAnimationEngine.prototype._getPreviousPlayers=function(element,instruction,isQueriedElement,namespaceId,triggerName){var players=[];if(isQueriedElement){var queriedElementPlayers=this.playersByQueriedElement.get(element);queriedElementPlayers&&(players=queriedElementPlayers)}else{var elementPlayers=this.playersByElement.get(element);if(elementPlayers){var isRemovalAnimation_1=instruction.toState==VOID_VALUE;elementPlayers.forEach(function(player){player.queued||(isRemovalAnimation_1||player.triggerName==instruction.triggerName)&&players.push(player)})}}return(namespaceId||triggerName)&&(players=players.filter(function(player){return(!namespaceId||namespaceId==player.namespaceId)&&(!triggerName||triggerName==player.triggerName)})),players},TransitionAnimationEngine.prototype._beforeAnimationBuild=function(namespaceId,instruction,allPreviousPlayersMap){var _this=this;eraseStyles(instruction.element,instruction.fromStyles);
var triggerName=instruction.triggerName,rootElement=instruction.element,targetNameSpaceId=instruction.isRemovalTransition?void 0:namespaceId,targetTriggerName=instruction.isRemovalTransition?void 0:triggerName;instruction.timelines.map(function(timelineInstruction){var element=timelineInstruction.element,isQueriedElement=element!==rootElement,players=getOrSetAsInMap(allPreviousPlayersMap,element,[]),previousPlayers=_this._getPreviousPlayers(element,instruction,isQueriedElement,targetNameSpaceId,targetTriggerName);previousPlayers.forEach(function(player){var realPlayer=player.getRealPlayer();realPlayer.beforeDestroy&&realPlayer.beforeDestroy(),players.push(player)})})},TransitionAnimationEngine.prototype._buildAnimation=function(namespaceId,instruction,allPreviousPlayersMap,skippedPlayersMap,preStylesMap,postStylesMap){var _this=this,triggerName=instruction.triggerName,rootElement=instruction.element,allQueriedPlayers=[],allConsumedElements=new Set,allNewPlayers=instruction.timelines.map(function(timelineInstruction){var element=timelineInstruction.element,isQueriedElement=element!==rootElement,previousPlayers=EMPTY_PLAYER_ARRAY;if(!allConsumedElements.has(element)){allConsumedElements.add(element);var _previousPlayers=allPreviousPlayersMap.get(element);_previousPlayers&&(previousPlayers=_previousPlayers.map(function(p){return p.getRealPlayer()}))}var preStyles=preStylesMap.get(element),postStyles=postStylesMap.get(element),keyframes=normalizeKeyframes(_this._driver,_this._normalizer,element,timelineInstruction.keyframes,preStyles,postStyles),player=_this._buildPlayer(timelineInstruction,keyframes,previousPlayers);if(timelineInstruction.subTimeline&&skippedPlayersMap&&getOrSetAsInMap(skippedPlayersMap,element,[]).push(player),isQueriedElement){var wrappedPlayer=new TransitionAnimationPlayer(namespaceId,triggerName,element);wrappedPlayer.setRealPlayer(player),allQueriedPlayers.push(wrappedPlayer)}return player});allQueriedPlayers.forEach(function(player){getOrSetAsInMap(_this.playersByQueriedElement,player.element,[]).push(player),player.onDone(function(){deleteOrUnsetInMap(_this.playersByQueriedElement,player.element,player)})}),allConsumedElements.forEach(function(element){element.classList.add(NG_ANIMATING_CLASSNAME)});var player=optimizeGroupPlayer(allNewPlayers);return player.onDone(function(){allConsumedElements.forEach(function(element){element.classList.remove(NG_ANIMATING_CLASSNAME)}),setStyles(rootElement,instruction.toStyles)}),player},TransitionAnimationEngine.prototype._buildPlayer=function(instruction,keyframes,previousPlayers){return keyframes.length>0?this._driver.animate(instruction.element,keyframes,instruction.duration,instruction.delay,instruction.easing,previousPlayers):new _angular_animations.NoopAnimationPlayer},TransitionAnimationEngine}(),TransitionAnimationPlayer=function(){function TransitionAnimationPlayer(namespaceId,triggerName,element){this.namespaceId=namespaceId,this.triggerName=triggerName,this.element=element,this._player=new _angular_animations.NoopAnimationPlayer,this._containsRealPlayer=!1,this._queuedCallbacks={},this._destroyed=!1,this.markedForDestroy=!1}return Object.defineProperty(TransitionAnimationPlayer.prototype,"queued",{get:function(){return 0==this._containsRealPlayer},enumerable:!0,configurable:!0}),Object.defineProperty(TransitionAnimationPlayer.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),TransitionAnimationPlayer.prototype.setRealPlayer=function(player){var _this=this;this._containsRealPlayer||(this._player=player,Object.keys(this._queuedCallbacks).forEach(function(phase){_this._queuedCallbacks[phase].forEach(function(callback){listenOnPlayer(player,phase,null,callback)})}),this._queuedCallbacks={},this._containsRealPlayer=!0)},TransitionAnimationPlayer.prototype.getRealPlayer=function(){return this._player},TransitionAnimationPlayer.prototype._queueEvent=function(name,callback){getOrSetAsInMap(this._queuedCallbacks,name,[]).push(callback)},TransitionAnimationPlayer.prototype.onDone=function(fn){this.queued&&this._queueEvent("done",fn),this._player.onDone(fn)},TransitionAnimationPlayer.prototype.onStart=function(fn){this.queued&&this._queueEvent("start",fn),this._player.onStart(fn)},TransitionAnimationPlayer.prototype.onDestroy=function(fn){this.queued&&this._queueEvent("destroy",fn),this._player.onDestroy(fn)},TransitionAnimationPlayer.prototype.init=function(){this._player.init()},TransitionAnimationPlayer.prototype.hasStarted=function(){return!this.queued&&this._player.hasStarted()},TransitionAnimationPlayer.prototype.play=function(){!this.queued&&this._player.play()},TransitionAnimationPlayer.prototype.pause=function(){!this.queued&&this._player.pause()},TransitionAnimationPlayer.prototype.restart=function(){!this.queued&&this._player.restart()},TransitionAnimationPlayer.prototype.finish=function(){this._player.finish()},TransitionAnimationPlayer.prototype.destroy=function(){this._destroyed=!0,this._player.destroy()},TransitionAnimationPlayer.prototype.reset=function(){!this.queued&&this._player.reset()},TransitionAnimationPlayer.prototype.setPosition=function(p){this.queued||this._player.setPosition(p)},TransitionAnimationPlayer.prototype.getPosition=function(){return this.queued?0:this._player.getPosition()},Object.defineProperty(TransitionAnimationPlayer.prototype,"totalTime",{get:function(){return this._player.totalTime},enumerable:!0,configurable:!0}),TransitionAnimationPlayer}(),DomAnimationEngine=function(){function DomAnimationEngine(driver,normalizer){var _this=this;this._triggerCache={},this.onRemovalComplete=function(element,context){},this._transitionEngine=new TransitionAnimationEngine(driver,normalizer),this._timelineEngine=new TimelineAnimationEngine(driver,normalizer),this._transitionEngine.onRemovalComplete=function(element,context){_this.onRemovalComplete(element,context)}}return DomAnimationEngine.prototype.registerTrigger=function(componentId,namespaceId,hostElement,name,metadata){var cacheKey=componentId+"-"+name,trigger=this._triggerCache[cacheKey];if(!trigger){var errors=[],ast=buildAnimationAst(metadata,errors);if(errors.length)throw new Error('The animation trigger "'+name+'" has failed to build due to the following errors:\n - '+errors.join("\n - "));trigger=buildTrigger(name,ast),this._triggerCache[cacheKey]=trigger}this._transitionEngine.register(namespaceId,hostElement,name,trigger)},DomAnimationEngine.prototype.destroy=function(namespaceId,context){this._transitionEngine.destroy(namespaceId,context)},DomAnimationEngine.prototype.onInsert=function(namespaceId,element,parent,insertBefore){this._transitionEngine.insertNode(namespaceId,element,parent,insertBefore)},DomAnimationEngine.prototype.onRemove=function(namespaceId,element,context){this._transitionEngine.removeNode(namespaceId,element,context)},DomAnimationEngine.prototype.setProperty=function(namespaceId,element,property,value){if("@"==property.charAt(0)){var _a=parseCustomCommand(property),id=_a[0],action=_a[1],args=value;return this._timelineEngine.command(id,element,action,args),!1}return this._transitionEngine.trigger(namespaceId,element,property,value)},DomAnimationEngine.prototype.listen=function(namespaceId,element,eventName,eventPhase,callback){if("@"==eventName.charAt(0)){var _a=parseCustomCommand(eventName),id=_a[0],action=_a[1];return this._timelineEngine.listen(id,element,action,callback)}return this._transitionEngine.listen(namespaceId,element,eventName,eventPhase,callback)},DomAnimationEngine.prototype.flush=function(){this._transitionEngine.flush()},Object.defineProperty(DomAnimationEngine.prototype,"players",{get:function(){return this._transitionEngine.players.concat(this._timelineEngine.players)},enumerable:!0,configurable:!0}),DomAnimationEngine}(),DEFAULT_STATE_VALUE$1="void",DEFAULT_STATE_STYLES="*",NoopAnimationEngine=function(_super){function NoopAnimationEngine(){var _this=_super.apply(this,arguments)||this;return _this._listeners=new Map,_this._changes=[],_this._flaggedRemovals=new Set,_this._onDoneFns=[],_this._triggerStyles=Object.create(null),_this.onRemovalComplete=function(element,context){},_this}return __extends(NoopAnimationEngine,_super),NoopAnimationEngine.prototype.registerTrigger=function(componentId,namespaceId,hostElement,name,metadata){if(name=name||metadata.name,name=namespaceId+"#"+name,!this._triggerStyles[name]){var errors=[],ast=buildAnimationAst(metadata,errors),trigger=buildTrigger(name,ast);this._triggerStyles[name]=trigger.states}},NoopAnimationEngine.prototype.onInsert=function(namespaceId,element,parent,insertBefore){},NoopAnimationEngine.prototype.onRemove=function(namespaceId,element,context){this.onRemovalComplete(element,context),1==element.nodeType&&this._flaggedRemovals.add(element)},NoopAnimationEngine.prototype.setProperty=function(namespaceId,element,property,value){if("@"!=property.charAt(0)){var namespacedName=namespaceId+"#"+property,storageProp=makeStorageProp(namespacedName),oldValue=element[storageProp]||DEFAULT_STATE_VALUE$1;this._changes.push({element:element,oldValue:oldValue,newValue:value,triggerName:property,namespacedName:namespacedName});var triggerStateStyles=this._triggerStyles[namespacedName]||{},fromStateStyles=triggerStateStyles[oldValue]||triggerStateStyles[DEFAULT_STATE_STYLES];fromStateStyles&&eraseStyles(element,fromStateStyles),element[storageProp]=value,this._onDoneFns.push(function(){var toStateStyles=triggerStateStyles[value]||triggerStateStyles[DEFAULT_STATE_STYLES];toStateStyles&&setStyles(element,toStateStyles)})}},NoopAnimationEngine.prototype.listen=function(namespaceId,element,eventName,eventPhase,callback){if("@"!=eventName.charAt(0)){var listeners=this._listeners.get(element);listeners||this._listeners.set(element,listeners=[]);var tuple={namespacedName:namespaceId+"#"+eventName,triggerName:eventName,eventPhase:eventPhase,callback:callback};return listeners.push(tuple),function(){return tuple.doRemove=!0}}},NoopAnimationEngine.prototype.flush=function(){function handleListener(listener,data){var phase=listener.eventPhase,event=makeAnimationEvent$1(data.element,data.triggerName,data.oldValue,data.newValue,phase,0);"start"==phase?onStartCallbacks.push(function(){return listener.callback(event)}):"done"==phase&&onDoneCallbacks.push(function(){return listener.callback(event)})}var _this=this,onStartCallbacks=[],onDoneCallbacks=[];this._changes.forEach(function(change){var element=change.element,listeners=_this._listeners.get(element);listeners&&listeners.forEach(function(listener){listener.namespacedName==change.namespacedName&&handleListener(listener,change)})}),this._flaggedRemovals.forEach(function(element){var listeners=_this._listeners.get(element);listeners&&listeners.forEach(function(listener){var triggerName=listener.triggerName,namespacedName=listener.namespacedName,storageProp=makeStorageProp(namespacedName);handleListener(listener,{element:element,triggerName:triggerName,namespacedName:listener.namespacedName,oldValue:element[storageProp]||DEFAULT_STATE_VALUE$1,newValue:DEFAULT_STATE_VALUE$1})})}),Array.from(this._listeners.keys()).forEach(function(element){var listenersToKeep=_this._listeners.get(element).filter(function(l){return!l.doRemove});listenersToKeep.length?_this._listeners.set(element,listenersToKeep):_this._listeners.delete(element)}),onStartCallbacks.forEach(function(fn){return fn()}),onDoneCallbacks.forEach(function(fn){return fn()}),this._flaggedRemovals.clear(),this._changes=[],this._onDoneFns.forEach(function(doneFn){return doneFn()}),this._onDoneFns=[]},Object.defineProperty(NoopAnimationEngine.prototype,"players",{get:function(){return[]},enumerable:!0,configurable:!0}),NoopAnimationEngine.prototype.destroy=function(namespaceId){},NoopAnimationEngine}(AnimationEngine),WebAnimationsPlayer=function(){function WebAnimationsPlayer(element,keyframes,options,previousPlayers){void 0===previousPlayers&&(previousPlayers=[]);var _this=this;this.element=element,this.keyframes=keyframes,this.options=options,this.previousPlayers=previousPlayers,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=options.duration,this._delay=options.delay||0,this.time=this._duration+this._delay,this.previousStyles={},previousPlayers.forEach(function(player){var styles=player.currentSnapshot;Object.keys(styles).forEach(function(prop){return _this.previousStyles[prop]=styles[prop]})})}return WebAnimationsPlayer.prototype._onFinish=function(){this._finished||(this._finished=!0,this._onDoneFns.forEach(function(fn){return fn()}),this._onDoneFns=[])},WebAnimationsPlayer.prototype.init=function(){var _this=this;if(!this._initialized){this._initialized=!0;var keyframes=this.keyframes.map(function(styles){return copyStyles(styles,!1)}),previousStyleProps=Object.keys(this.previousStyles);if(previousStyleProps.length){var startingKeyframe_1=keyframes[0],missingStyleProps_1=[];if(previousStyleProps.forEach(function(prop){startingKeyframe_1.hasOwnProperty(prop)||missingStyleProps_1.push(prop),startingKeyframe_1[prop]=_this.previousStyles[prop]}),missingStyleProps_1.length)for(var self_1=this,_loop_1=function(){var kf=keyframes[i];missingStyleProps_1.forEach(function(prop){kf[prop]=_computeStyle(self_1.element,prop)})},i=1;i<keyframes.length;i++)_loop_1()}this._player=this._triggerWebAnimation(this.element,keyframes,this.options),this._finalKeyframe=keyframes.length?keyframes[keyframes.length-1]:{},this._delay?this._resetDomPlayerState():this._player.pause(),this._player.addEventListener("finish",function(){return _this._onFinish()})}},WebAnimationsPlayer.prototype._triggerWebAnimation=function(element,keyframes,options){return element.animate(keyframes,options)},Object.defineProperty(WebAnimationsPlayer.prototype,"domPlayer",{get:function(){return this._player},enumerable:!0,configurable:!0}),WebAnimationsPlayer.prototype.onStart=function(fn){this._onStartFns.push(fn)},WebAnimationsPlayer.prototype.onDone=function(fn){this._onDoneFns.push(fn)},WebAnimationsPlayer.prototype.onDestroy=function(fn){this._onDestroyFns.push(fn)},WebAnimationsPlayer.prototype.play=function(){this.init(),this.hasStarted()||(this._onStartFns.forEach(function(fn){return fn()}),this._onStartFns=[],this._started=!0),this._player.play()},WebAnimationsPlayer.prototype.pause=function(){this.init(),this._player.pause()},WebAnimationsPlayer.prototype.finish=function(){this.init(),this._onFinish(),this._player.finish()},WebAnimationsPlayer.prototype.reset=function(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1},WebAnimationsPlayer.prototype._resetDomPlayerState=function(){this._player&&this._player.cancel()},WebAnimationsPlayer.prototype.restart=function(){this.reset(),this.play()},WebAnimationsPlayer.prototype.hasStarted=function(){return this._started},WebAnimationsPlayer.prototype.destroy=function(){this._destroyed||(this._resetDomPlayerState(),this._onFinish(),this._destroyed=!0,this._onDestroyFns.forEach(function(fn){return fn()}),this._onDestroyFns=[])},WebAnimationsPlayer.prototype.setPosition=function(p){this._player.currentTime=p*this.time},WebAnimationsPlayer.prototype.getPosition=function(){return this._player.currentTime/this.time},Object.defineProperty(WebAnimationsPlayer.prototype,"totalTime",{get:function(){return this._delay+this._duration},enumerable:!0,configurable:!0}),WebAnimationsPlayer.prototype.beforeDestroy=function(){var _this=this,styles={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(function(prop){"offset"!=prop&&(styles[prop]=_this._finished?_this._finalKeyframe[prop]:_computeStyle(_this.element,prop))}),this.currentSnapshot=styles},WebAnimationsPlayer}(),WebAnimationsDriver=function(){function WebAnimationsDriver(){}return WebAnimationsDriver.prototype.computeStyle=function(element,prop,defaultValue){return window.getComputedStyle(element)[prop]},WebAnimationsDriver.prototype.animate=function(element,keyframes,duration,delay,easing,previousPlayers){void 0===previousPlayers&&(previousPlayers=[]);var fill=0==delay?"both":"forwards",playerOptions={duration:duration,delay:delay,fill:fill};easing&&(playerOptions.easing=easing);var previousWebAnimationPlayers=previousPlayers.filter(function(player){return player instanceof WebAnimationsPlayer});return new WebAnimationsPlayer(element,keyframes,playerOptions,previousWebAnimationPlayers)},WebAnimationsDriver}();exports.AnimationDriver=AnimationDriver,exports.ÉµAnimationEngine=AnimationEngine,exports.ÉµAnimation=Animation,exports.ÉµAnimationStyleNormalizer=AnimationStyleNormalizer,exports.ÉµNoopAnimationStyleNormalizer=NoopAnimationStyleNormalizer,exports.ÉµWebAnimationsStyleNormalizer=WebAnimationsStyleNormalizer,exports.ÉµNoopAnimationDriver=NoopAnimationDriver,exports.ÉµDomAnimationEngine=DomAnimationEngine,exports.ÉµNoopAnimationEngine=NoopAnimationEngine,exports.ÉµWebAnimationsDriver=WebAnimationsDriver,exports.ÉµsupportsWebAnimations=supportsWebAnimations,exports.ÉµWebAnimationsPlayer=WebAnimationsPlayer,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=animations-browser.umd.min.js.map
